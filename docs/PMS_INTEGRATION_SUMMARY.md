# PMS æ•´åˆå¥—ä»¶ç¸½çµæ–‡ä»¶

> **å°ˆæ¡ˆç›®æ¨™**ï¼šå°‡å¾·å®‰è³‡è¨Š PMSï¼ˆOracle Databaseï¼‰æ•´åˆåˆ° KTW-bot LINE BOT ç³»çµ±

**å»ºç«‹æ—¥æœŸ**ï¼š2025-12-10  
**ç‹€æ…‹**ï¼šâœ… è³‡æ–™åº«æ¢ç´¢å®Œæˆ â†’ â³ API é–‹ç™¼æº–å‚™ä¸­

---

## ğŸ“‹ ä»Šæ—¥æˆæœç¸½è¦½

### âœ… å·²å®Œæˆé …ç›®

1. **Oracle è³‡æ–™åº«é€£æ¥**
   - æˆåŠŸå–å¾— OS é©—è­‰å­˜å–æ¬Šé™
   - è³‡æ–™åº«ï¼šOracle Database 12.2.0
   - SIDï¼šgdwuukt
   - ä¸»æ©Ÿï¼šgdwuukt-db01ï¼ˆæœ¬æ©Ÿï¼‰

2. **è³‡æ–™åº«çµæ§‹æ¢ç´¢**
   - ORDER_MNï¼ˆè¨‚å–®ä¸»æª”ï¼‰- è¨‚æˆ¿åŸºæœ¬è³‡è¨Š
   - ORDER_DTï¼ˆè¨‚å–®æ˜ç´°ï¼‰- æˆ¿é–“ã€åƒ¹æ ¼ã€äººæ•¸
   - ROOM_RFï¼ˆæˆ¿å‹åƒè€ƒï¼‰- æˆ¿å‹å®šç¾©
   - ROOM_MNï¼ˆæˆ¿é–“ä¸»æª”ï¼‰- å¯¦éš›æˆ¿é–“ç‹€æ…‹
   - RMINV_MNï¼ˆæˆ¿é–“åº«å­˜ï¼‰- æ¯æ—¥å¯ç”¨æˆ¿æ•¸

3. **API è¦æ ¼è¨­è¨ˆ**
   - 5 å€‹æ ¸å¿ƒ REST API ç«¯é»
   - å®Œæ•´ SQL æŸ¥è©¢ç¯„ä¾‹
   - JSON è³‡æ–™æ ¼å¼å®šç¾©
   - éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

4. **æ•´åˆæ–¹æ¡ˆè¦åŠƒ**
   - ç¢ºèªæ¡ç”¨æ–¹æ¡ˆ Aï¼šPMS API ç‚ºä¸»è¦è³‡æ–™æº
   - è¨­è¨ˆ Next.js å¾Œå°æ¶æ§‹
   - è¦åŠƒ BOT è³‡æ–™æµå‘

---

## ğŸ—‚ï¸ æ–‡ä»¶æ¸…å–®

æ‰€æœ‰æ–‡ä»¶ä½æ–¼ï¼š`/Users/ktw/.gemini/antigravity/brain/4673da49-130a-4d10-bbd1-466a008cfa73/`

| æ–‡ä»¶åç¨± | ç”¨é€” | ç‹€æ…‹ |
|---------|------|------|
| [task.md](file:///Users/ktw/.gemini/antigravity/brain/4673da49-130a-4d10-bbd1-466a008cfa73/task.md) | ä»»å‹™æ¸…å–®èˆ‡é€²åº¦è¿½è¹¤ | âœ… |
| [implementation_plan.md](file:///Users/ktw/.gemini/antigravity/brain/4673da49-130a-4d10-bbd1-466a008cfa73/implementation_plan.md) | æ•´é«”å¯¦ä½œè¨ˆç•« | âœ… |
| [pms_data_access_plan.md](file:///Users/ktw/.gemini/antigravity/brain/4673da49-130a-4d10-bbd1-466a008cfa73/pms_data_access_plan.md) | PMS è³‡æ–™å­˜å–è¨ˆç•« | âœ… |
| [oracle_access_guide.md](file:///Users/ktw/.gemini/antigravity/brain/4673da49-130a-4d10-bbd1-466a008cfa73/oracle_access_guide.md) | Oracle å­˜å–æŒ‡å— | âœ… |
| [oracle_connection_steps.md](file:///Users/ktw/.gemini/antigravity/brain/4673da49-130a-4d10-bbd1-466a008cfa73/oracle_connection_steps.md) | Oracle é€£ç·šæ­¥é©Ÿ | âœ… |
| [oracle_sql_commands.md](file:///Users/ktw/.gemini/antigravity/brain/4673da49-130a-4d10-bbd1-466a008cfa73/oracle_sql_commands.md) | SQL æ¢ç´¢æŒ‡ä»¤é›† | âœ… |
| [pms_database_structure.md](file:///Users/ktw/.gemini/antigravity/brain/4673da49-130a-4d10-bbd1-466a008cfa73/pms_database_structure.md) | è³‡æ–™åº«çµæ§‹åˆ†æ | âœ… |
| [pms_api_specification.md](file:///Users/ktw/.gemini/antigravity/brain/4673da49-130a-4d10-bbd1-466a008cfa73/pms_api_specification.md) | **REST API å®Œæ•´è¦æ ¼** | âœ… |
| [bot_pms_integration_plan.md](file:///Users/ktw/.gemini/antigravity/brain/4673da49-130a-4d10-bbd1-466a008cfa73/bot_pms_integration_plan.md) | BOT æ•´åˆæ–¹æ¡ˆåˆ†æ | âœ… |

---

## ğŸ—ï¸ KTW-bot æ•´åˆæ¶æ§‹

### æœ€çµ‚æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     KTW-bot å°ˆæ¡ˆ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   LINE BOT      â”‚              â”‚  Next.js å¾Œå°    â”‚  â”‚
â”‚  â”‚   (Python)      â”‚              â”‚  (ç®¡ç†ä»‹é¢)      â”‚  â”‚
â”‚  â”‚                 â”‚              â”‚                  â”‚  â”‚
â”‚  â”‚ - å®¢äººæŸ¥è©¢è¨‚å–®   â”‚              â”‚ - è¨‚å–®ç®¡ç†       â”‚  â”‚
â”‚  â”‚ - å¤©æ°£è³‡è¨Š      â”‚              â”‚ - æˆ¿æ³ç¸½è¦½       â”‚  â”‚
â”‚  â”‚ - FAQ å›æ‡‰      â”‚              â”‚ - BOT ç›£æ§       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                                 â”‚            â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                        â”‚                                 â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚              â”‚   PMS REST API     â”‚ â† æ–°å¢æ¨¡çµ„           â”‚
â”‚              â”‚  (Node.js/Express) â”‚                      â”‚
â”‚              â”‚                    â”‚                      â”‚
â”‚              â”‚ GET /api/bookings  â”‚                      â”‚
â”‚              â”‚ GET /api/rooms     â”‚                      â”‚
â”‚              â”‚ POST /api/bookings â”‚                      â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                        â”‚                                 â”‚
â”‚                        â–¼                                 â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚  Oracle Database â”‚                        â”‚
â”‚              â”‚  (PMS - å¾·å®‰è³‡è¨Š)â”‚                        â”‚
â”‚              â”‚                  â”‚                        â”‚
â”‚              â”‚  - ORDER_MN      â”‚                        â”‚
â”‚              â”‚  - ORDER_DT      â”‚                        â”‚
â”‚              â”‚  - ROOM_RF       â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ å»ºè­°çš„å°ˆæ¡ˆçµæ§‹

```
KTW-bot/
â”œâ”€â”€ bot.py                    # ç¾æœ‰ LINE BOT (ä¿®æ”¹ï¼šä½¿ç”¨ PMS API)
â”œâ”€â”€ app.py                    # ç¾æœ‰ Flask app
â”œâ”€â”€ pms-api/                  # â† æ–°å¢ï¼šPMS API æ¨¡çµ„
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ server.js             # Express ä¸»ç¨‹å¼
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ database.js       # Oracle é€£ç·šè¨­å®š
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ bookings.js       # è¨‚å–®ç›¸é—œ API
â”‚   â”‚   â””â”€â”€ rooms.js          # æˆ¿é–“ç›¸é—œ API
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ bookingController.js
â”‚   â”‚   â””â”€â”€ roomController.js
â”‚   â””â”€â”€ models/
â”‚       â”œâ”€â”€ booking.js
â”‚       â””â”€â”€ room.js
â”œâ”€â”€ admin-dashboard/          # â† æ–°å¢ï¼šNext.js å¾Œå°
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ index.tsx         # é¦–é ï¼ˆè¨‚å–®ç¸½è¦½ï¼‰
â”‚   â”‚   â”œâ”€â”€ bookings/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx     # è¨‚å–®åˆ—è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ [id].tsx      # è¨‚å–®è©³æƒ…
â”‚   â”‚   â””â”€â”€ rooms/
â”‚   â”‚       â””â”€â”€ index.tsx     # æˆ¿æ³ç¸½è¦½
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ BookingList.tsx
â”‚   â”‚   â”œâ”€â”€ RoomCalendar.tsx
â”‚   â”‚   â””â”€â”€ BotMonitor.tsx
â”‚   â””â”€â”€ lib/
â”‚       â””â”€â”€ api.ts            # API å‘¼å«å‡½å¼
â”œâ”€â”€ docs/                     # â† æ–°å¢ï¼šæ•´åˆæ–‡ä»¶
â”‚   â”œâ”€â”€ pms_api_spec.md
â”‚   â”œâ”€â”€ database_structure.md
â”‚   â””â”€â”€ integration_guide.md
â””â”€â”€ README.md
```

---

## ğŸš€ æ•´åˆæ­¥é©Ÿ

### éšæ®µ 1ï¼šå»ºç«‹ PMS APIï¼ˆé è¨ˆ 2-3 å¤©ï¼‰

1. **åˆå§‹åŒ– Node.js å°ˆæ¡ˆ**
   ```bash
   cd KTW-bot
   mkdir pms-api && cd pms-api
   npm init -y
   npm install express oracledb dotenv cors
   ```

2. **å¯¦ä½œ API ç«¯é»**ï¼ˆåƒè€ƒ `pms_api_specification.md`ï¼‰
   - âœ… GET /api/bookings/search
   - âœ… GET /api/bookings/:id
   - âœ… GET /api/rooms/availability
   - âœ… POST /api/bookings
   - âœ… DELETE /api/bookings/:id

3. **æ¸¬è©¦ API**
   ```bash
   npm run dev
   curl http://localhost:3000/api/bookings/00150501
   ```

---

### éšæ®µ 2ï¼šèª¿æ•´ LINE BOTï¼ˆé è¨ˆ 1 å¤©ï¼‰

**ä¿®æ”¹ `bot.py` çš„ `check_order_status` å‡½å¼**ï¼š

```python
# èˆŠç‰ˆï¼ˆGmail APIï¼‰
def check_order_status(order_id):
    # æŸ¥è©¢ Gmail...
    pass

# æ–°ç‰ˆï¼ˆPMS APIï¼‰
import requests

def check_order_status(order_id):
    try:
        response = requests.get(f'http://localhost:3000/api/bookings/{order_id}')
        data = response.json()
        
        if data['success']:
            booking = data['data']
            return format_booking_message(booking)
        else:
            return "æ‰¾ä¸åˆ°è¨‚å–®"
    except Exception as e:
        # Fallback to Gmail if API fails
        return check_order_gmail(order_id)
```

---

### éšæ®µ 3ï¼šå»ºç«‹ Next.js å¾Œå°ï¼ˆé è¨ˆ 3-4 å¤©ï¼‰

1. **åˆå§‹åŒ– Next.js å°ˆæ¡ˆ**
   ```bash
   cd KTW-bot
   npx create-next-app@latest admin-dashboard --typescript --tailwind
   ```

2. **å¯¦ä½œæ ¸å¿ƒé é¢**
   - è¨‚å–®ç®¡ç†
   - æˆ¿æ³ç¸½è¦½
   - BOT ç›£æ§

3. **ä¸²æ¥ PMS API**
   ```typescript
   // lib/api.ts
   export async function getBookings() {
     const res = await fetch('http://localhost:3000/api/bookings/search')
     return res.json()
   }
   ```

---

### éšæ®µ 4ï¼šéƒ¨ç½²ï¼ˆé è¨ˆ 1-2 å¤©ï¼‰

1. **PMS API éƒ¨ç½²**
   - éƒ¨ç½²åˆ° Windows Serverï¼ˆèˆ‡ PMS åŒæ©Ÿï¼‰
   - è¨­å®šç’°å¢ƒè®Šæ•¸ï¼ˆOracle é€£ç·šè³‡è¨Šï¼‰
   - é…ç½® PM2 æˆ– Windows Service

2. **Next.js å¾Œå°éƒ¨ç½²**
   - Vercelï¼ˆæ¨è–¦ï¼‰æˆ–è‡ªæ¶ä¼ºæœå™¨
   - é…ç½® API ç«¯é»

3. **LINE BOT æ›´æ–°**
   - æ›´æ–° API ç«¯é»åˆ°æ­£å¼ç’°å¢ƒ
   - æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½

---

## ğŸ”‘ é—œéµè³‡è¨Š

### Oracle é€£ç·šé…ç½®

```javascript
// pms-api/config/database.js
module.exports = {
  user: 'system',
  password: process.env.DB_PASSWORD, // ä½¿ç”¨ç’°å¢ƒè®Šæ•¸
  connectString: 'gdwuukt-db01:1521/gdwuukt'
}
```

### ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹

```env
# .env
DB_PASSWORD=your_oracle_password
PORT=3000
NODE_ENV=production
```

---

## ğŸ“Š API è³‡æ–™æ ¼å¼ï¼ˆçµ¦ BOT ä½¿ç”¨ï¼‰

**æŸ¥è©¢è¨‚å–®éŸ¿æ‡‰**ï¼š
```json
{
  "success": true,
  "data": {
    "booking_id": "00150501",
    "guest_name": "ç‹å°æ˜",
    "contact_phone": "0920351552",
    "check_in_date": "2025-12-15",
    "check_out_date": "2025-12-17",
    "nights": 2,
    "status": "O",
    "status_name": "å·²ç¢ºèª",
    "rooms": [
      {
        "room_type": "é›™äººæˆ¿",
        "room_count": 1,
        "adult_count": 2,
        "child_count": 0
      }
    ]
  }
}
```

---

## âš ï¸ æ³¨æ„äº‹é …

### å®‰å…¨æ€§
1. âœ… ä½¿ç”¨ OS é©—è­‰é€£æ¥ Oracleï¼ˆå·²è¨­å®š ORA_DBA ç¾¤çµ„ï¼‰
2. âš ï¸ API éœ€è¦åŠ å…¥èªè­‰æ©Ÿåˆ¶ï¼ˆAPI Key æˆ– JWTï¼‰
3. âš ï¸ ç’°å¢ƒè®Šæ•¸ä¸è¦æäº¤åˆ° Git
4. âœ… ä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢é˜²æ­¢ SQL Injection

### æ•ˆèƒ½
1. å»ºè­°ä½¿ç”¨é€£ç·šæ± ï¼ˆoracledb.createPoolï¼‰
2. æŸ¥è©¢çµæœå¯ä»¥åŠ å…¥å¿«å–ï¼ˆRedisï¼‰
3. API å›æ‡‰æ™‚é–“æ‡‰ < 500ms

### å‚™æ´
1. PMS API æ•…éšœæ™‚ï¼ŒBOT å¯ fallback åˆ° Gmail
2. è³‡æ–™åº«å®šæœŸå‚™ä»½
3. API éŒ¯èª¤ç›£æ§èˆ‡å‘Šè­¦

---

## ğŸ“ å¾ŒçºŒæ”¯æ´

**éœ€è¦å”åŠ©æ™‚**ï¼Œåƒè€ƒä»¥ä¸‹æ–‡ä»¶ï¼š
- API é–‹ç™¼ï¼š`pms_api_specification.md`
- è³‡æ–™åº«æŸ¥è©¢ï¼š`pms_database_structure.md`
- Oracle é€£ç·šï¼š`oracle_access_guide.md`

**ä¸‹ä¸€æ­¥è¡Œå‹•**ï¼š
1. â³ å»ºç«‹ Node.js PMS API å°ˆæ¡ˆ
2. â³ å¯¦ä½œ 5 å€‹æ ¸å¿ƒç«¯é»
3. â³ æ¸¬è©¦ API èˆ‡ Oracle é€£ç·š
4. â³ èª¿æ•´ LINE BOT æŸ¥è©¢é‚è¼¯
5. â³ å»ºç«‹ Next.js å¾Œå°

---

## ğŸ¯ å°ˆæ¡ˆç›®æ¨™é”æˆæŒ‡æ¨™

- [ ] LINE BOT å¯é€é API æŸ¥è©¢è¨‚å–®
- [ ] Next.js å¾Œå°å¯ç®¡ç†è¨‚å–®
- [ ] API å›æ‡‰æ™‚é–“ < 500ms
- [ ] éŒ¯èª¤ç‡ < 1%
- [ ] å®Œæ•´çš„éŒ¯èª¤è™•ç†èˆ‡æ—¥èªŒè¨˜éŒ„

---

**å»ºç«‹æ—¥æœŸ**ï¼š2025-12-10  
**æœ€å¾Œæ›´æ–°**ï¼š2025-12-10  
**ç‹€æ…‹**ï¼šâœ… è¦åŠƒå®Œæˆï¼Œæº–å‚™é–‹ç™¼
