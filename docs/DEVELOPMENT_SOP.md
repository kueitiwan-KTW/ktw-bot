# KTW Bot 開發標準作業程序 (Development SOP)

> 本文件整合了專案的核心價值觀與具體執行規範，為開發工作的最高指導原則。

---

## 1. 核心理念與原則 (Core Principles)

### 1.1 核心價值
*   **專業紀錄**：專業並記錄筆記結果，同步上傳 Notion/GitHub。都需採繁體中文，如需用到英文需加上中文註解 (Chinese Annotation)，尊崇 DRY (Don't Repeat Yourself) 原則。
*   **簡潔至上**：恪守 KISS (Keep It Simple, Stupid) 原則，崇尚簡潔與可維護性，避免過度工程化與不必要的防禦性設計。
*   **深度分析**：立足於第一性原理 (First Principles Thinking) 剖析問題，並善用工具以提升效率。
*   **事實為本**：以事實為最高準則。若有任何誤解，懇請坦率扶正，助我精進。

### 1.2 開發與流程
*   **開發工作流程**：均採 System + Function 的最佳自動化客服人員結構。
*   **漸進式開發**：通過多輪對話迭代，明確並實現需求。在著手任何設計或編碼工作前，必須完成前期調研並釐清所有疑點，需參考先前資料或筆記。
*   **結構化流程**：嚴格遵循「構思方案 → 提煉骨架 → 分解為具體任務」的作業順序。

### 1.3 輸出規範
*   **測試驗證**：輸出前自己必須模擬真實測試，反覆確認。
*   **語言要求**：所有回覆、思考過程及任務清單，均須使用繁體中文。
*   **固定格式**：`Implementation Plan`, `Task List`

---

## 2. 文檔持續迭代細則 (Documentation SOP)

> ⚠️ **執行原則**：程式碼與文檔必須同步。任何功能變更若未反映在文檔中，則視為「未完成」。

### 2.1 執行時機
- **每次任務結束前** (在交付成果之前)。
- 當修改了核心邏輯、API 介面或環境變數時。

### 2.2 自動檢查清單 (Auto-Checklist)
AI 代理在結束任務前，必須執行以下檢查：

1.  **目錄級 README**
    - 修改 `LINEBOT/` 程式碼 ➜ 更新 `LINEBOT/README.md`
    - 修改 `pms-api/` 程式碼 ➜ 更新 `pms-api/README.md`
    - **重點**：更新新功能說明、參數變更、依賴項。

2.  **API 規格文檔**
    - 變更 API 介面/格式 ➜ 更新 `pms-api/PMS-DATABASE-REFERENCE.md`。
    - 確保 `PMS-DATABASE-REFERENCE.md` 為資料庫結構的 **單一真實來源 (SSOT)**。

3.  **環境變數**
    - 新增 `.env` 變數 ➜ 同步更新 `.env.example`。

4.  **連結完整性**
    - 移動/重命名文件 ➜ 全域搜尋並修復所有斷裂的 Markdown 連結。

---

## 3. 程式修改前置標準流程 (Pre-Coding SOP)

> ⚠️ **執行原則**：在修改任何程式碼之前，必須嚴格執行以下三步驟。禁止直接寫 Code。

### 步驟 1：歷史回顧與文件查閱 (Context Retrieval)
*   **強制查閱**：必須先閱讀相關的 `README.md`、`GUIDE.md` 或架構文檔。
*   **確認現況**：理解現有程式碼的設計意圖，避免破壞既有邏輯 (Regression)。

### 步驟 2：前瞻後顧與最佳模式分析 (Impact Analysis)
*   **最佳模式**：思考「這是業界的最佳實踐 (Best Practice) 嗎？」
*   **前瞻**：這個修改對未來擴充有幫助嗎？會不會造成技術債？
*   **後顧**：這個修改會不會影響舊功能？是否與現有架構衝突？

### 步驟 3：方案研擬與利弊分析 (Scenario Planning)
在動手前，必須向使用者提出 **3 種解決方案**，並進行利弊分析：

| 方案 | 說明 | 優點 (Pros) | 缺點 (Cons) | 建議程度 |
|:---:|:---|:-----------|:-----------|:-------:|
| **A** | (方案名稱) | ... | ... | ⭐⭐⭐ |
| **B** | (方案名稱) | ... | ... | ⭐⭐ |
| **C** | (方案名稱) | ... | ... | ⭐ |

*   **討論與決策**：與使用者討論並達成共識後，才可進入實作階段 (Coding)。

---

*文件最後更新：2025-12-17*
