# KTW Bot é–‹ç™¼æ¨™æº–ä½œæ¥­ç¨‹åº (Development SOP)

> æœ¬æ–‡ä»¶æ•´åˆäº†å°ˆæ¡ˆçš„æ ¸å¿ƒåƒ¹å€¼è§€èˆ‡å…·é«”åŸ·è¡Œè¦ç¯„ï¼Œç‚ºé–‹ç™¼å·¥ä½œçš„æœ€é«˜æŒ‡å°åŸå‰‡ã€‚

---

> [!CAUTION] > **âš ï¸ å¼·åˆ¶æ€§æé†’ (MANDATORY)**
>
> åœ¨é€²è¡Œä»»ä½•**æ–°å¢ã€ç¶­è­·ã€ä¿®æ”¹**å·¥ä½œä¹‹å‰ï¼Œå¿…é ˆï¼š
>
> 1. âœ… **å…ˆå®Œæ•´é–±è®€æœ¬æ–‡ä»¶** (DEVELOPMENT_SOP.md)
> 2. âœ… **ç¢ºèªç›¸é—œè¦ç¯„èˆ‡åŸå‰‡**
> 3. âœ… **å†é–‹å§‹è¦åŠƒèˆ‡å¯¦ä½œ**
>
> **é•åæ­¤åŸå‰‡çš„è®Šæ›´å°‡è¢«è¦–ç‚ºä¸ç¬¦åˆå°ˆæ¡ˆæ¨™æº–ã€‚**

---

## 0. å°ˆæ¡ˆå®šä½èˆ‡ç™¼å±•ç­–ç•¥

> **ç­–ç•¥æ–¹å‘**ï¼šä»¥ SaaS åŒ–ç‚ºæœ€çµ‚ç›®æ¨™ï¼Œé€æ­¥æ·˜æ±°å–®ä¸€å®¢æˆ¶å°ˆç”¨ç³»çµ±ï¼Œèµ°å‘é€šç”¨å‹å…¨ç³»çµ± SaaS æ¶æ§‹ã€‚

### å°ˆæ¡ˆå®šä½è¡¨

| å°ˆæ¡ˆ                  | é¡å‹          | å®šä½                                | ç‹€æ…‹                      |
| :-------------------- | :------------ | :---------------------------------- | :------------------------ |
| **ktw-saas-platform** | SaaS ç®¡ç†å¹³å° | Payload CMS + å¤šç§Ÿæˆ¶ç®¡ç†            | ğŸš€ **ä¸»åŠ›é–‹ç™¼**           |
| **ktw-saas-bot**      | SaaS LINE Bot | é€šç”¨å‹å¤šç§Ÿæˆ¶ Bot                    | ğŸš€ **ä¸»åŠ›é–‹ç™¼**           |
| **ktw-bot**           | èˆŠç‰ˆ Bot      | KTW Hotel å°ˆç”¨ (LINEBOT, Admin-Web) | â¸ï¸ **ç¶­è­·æ¨¡å¼**ï¼Œé€æ­¥æ·˜æ±° |
| **ktw-web-pms**       | è¡Œæ¥­å°ˆç”¨ç³»çµ±  | æ—…å®¿è§€å…‰æ¥­ Web-PMS (SaaS åŒ–ç‚ºçµ‚æ—¨)  | ğŸ“‹ **å¾…å•†ç¢º**             |
| **ktw-docs**          | æ–‡æª”ä¸­å¿ƒ      | é€šç”¨é–‹ç™¼æ–‡æª”                        | âœ… æŒçºŒç¶­è­·               |
| **ktw-oracle-to-pg**  | é·ç§»å·¥å…·      | Oracle â†’ PostgreSQL                 | â¸ï¸ è¦–éœ€æ±‚ç¶­è­·             |

### ç™¼å±•è·¯ç·šåœ–

```
ç¾æ³                        ä¸­æœŸç›®æ¨™                     æœ€çµ‚ç›®æ¨™
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ktw-bot       â”‚   â†’    â”‚ ktw-saas-bot    â”‚   â†’    â”‚   é€šç”¨å‹ SaaS   â”‚
â”‚   (å–®ä¸€å®¢æˆ¶)     â”‚        â”‚ (å¤šç§Ÿæˆ¶ MVP)     â”‚        â”‚   Bot å¹³å°      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                          â†“                          â†“
  KTW Hotel å°ˆç”¨           KTW + 2-3 æ¸¬è©¦å®¢æˆ¶           N å€‹é£¯åº—å®¢æˆ¶
```

### é–‹ç™¼å„ªå…ˆé †åº

1. **å„ªå…ˆ**ï¼š`ktw-saas-platform` + `ktw-saas-bot` (SaaS æ ¸å¿ƒ)
2. **æ¬¡è¦**ï¼š`ktw-bot` ç¶­è­· (åƒ…ä¿®å¾©é‡å¤§ Bugï¼Œä¸æ–°å¢åŠŸèƒ½)
3. **å¾…å®š**ï¼š`ktw-web-pms` (æ—…å®¿è§€å…‰æ¥­å°ˆç”¨æ–¹æ¡ˆ)

---

## 1. æ ¸å¿ƒç†å¿µèˆ‡åŸå‰‡ (Core Principles)

### 1.1 æ ¸å¿ƒåƒ¹å€¼

- **å°ˆæ¥­ç´€éŒ„**ï¼šå°ˆæ¥­ä¸¦è¨˜éŒ„ç­†è¨˜çµæœï¼ŒåŒæ­¥ä¸Šå‚³ Notion/GitHubã€‚éƒ½éœ€æ¡ç¹é«”ä¸­æ–‡ï¼Œå¦‚éœ€ç”¨åˆ°è‹±æ–‡éœ€åŠ ä¸Šä¸­æ–‡è¨»è§£ (Chinese Annotation)ï¼Œå°Šå´‡ DRY (Don't Repeat Yourself) åŸå‰‡ã€‚
  - **å…¨èªå¢ƒç¹é«”ä¸­æ–‡**ï¼šå¾ AI çš„å…§éƒ¨æ€è€ƒ (`thought`)ã€å·¥å…·èª¿ç”¨åƒæ•¸ (`TaskName`, `TaskStatus`, `Summary`) åˆ°æœ€çµ‚è¼¸å‡ºï¼Œ**å…¨é¢ç¦æ­¢ä½¿ç”¨è‹±æ–‡æˆ–ç°¡é«”ä¸­æ–‡**ï¼ˆé™¤éæ˜¯ç¨‹å¼ç¢¼é—œéµå­—ã€API åç¨±æˆ–å°ˆæœ‰åè©ï¼‰ã€‚**è‹¥å› æŠ€è¡“å¿…è¦éœ€ä½¿ç”¨è‹±æ–‡è©å½™ï¼Œå¿…é ˆåœ¨å¾Œæ–¹æ‹¬è™Ÿè£œå……ç¹é«”ä¸­æ–‡è¨»è§£ (Chinese Annotation)**ã€‚
- **ç°¡æ½”è‡³ä¸Š**ï¼šæªå®ˆ KISS (Keep It Simple, Stupid) åŸå‰‡ï¼Œå´‡å°šç°¡æ½”èˆ‡å¯ç¶­è­·æ€§ï¼Œé¿å…éåº¦å·¥ç¨‹åŒ–èˆ‡ä¸å¿…è¦çš„é˜²ç¦¦æ€§è¨­è¨ˆã€‚
- **æ·±åº¦åˆ†æ**ï¼šç«‹è¶³æ–¼ç¬¬ä¸€æ€§åŸç† (First Principles Thinking) å‰–æå•é¡Œï¼Œä¸¦å–„ç”¨å·¥å…·ä»¥æå‡æ•ˆç‡ã€‚
- **äº‹å¯¦ç‚ºæœ¬**ï¼šä»¥äº‹å¯¦ç‚ºæœ€é«˜æº–å‰‡ã€‚è‹¥æœ‰ä»»ä½•èª¤è§£ï¼Œæ‡‡è«‹å¦ç‡æ‰¶æ­£ï¼ŒåŠ©æˆ‘ç²¾é€²ã€‚
- **ç ”ç©¶å°å‘** â­ï¼šä»»ä½•è³‡è¨Šæä¾›å‰å¿…é ˆï¼š
  1. âœ… **ä¸Šç¶²æŸ¥è©¢**ï¼šæœå°‹ç›¸é—œé ˜åŸŸçš„å°ˆæ¥­çŸ¥è­˜èˆ‡æ…£ä¾‹
  2. âœ… **æ·±åº¦æ€è€ƒ**ï¼šçµåˆä¸Šä¸‹æ–‡ã€å¯¦éš›æ•¸æ“šã€æ¥­å‹™é‚è¼¯ç¶œåˆåˆ†æ
  3. âœ… **å…¨é¢åˆ¤æ–·**ï¼šè€ƒæ…®æ‰€æœ‰å¯èƒ½çš„è§£é‡‹èˆ‡æ–¹æ¡ˆ
  4. âœ… **è©³ç´°å…§å®¹**ï¼šæä¾›å®Œæ•´è³‡è¨Šï¼Œä¸éºæ¼é‡è¦ç´°ç¯€
  5. âœ… **åˆ©å¼Šåƒè€ƒ**ï¼šè‹¥æœ‰å¤šç¨®å¯èƒ½è§£é‡‹æˆ–æ–¹æ¡ˆï¼Œåˆ—å‡ºå„è‡ªåˆ©å¼Šä¾›æ±ºç­–

### 1.2 é–‹ç™¼èˆ‡æµç¨‹

- **é–‹ç™¼å·¥ä½œæµç¨‹**ï¼šå‡æ¡ **System + Function Calling** çš„æœ€ä½³è‡ªå‹•åŒ–å®¢æœäººå“¡çµæ§‹ã€‚
- **æ¼¸é€²å¼é–‹ç™¼**ï¼šé€šéå¤šè¼ªå°è©±è¿­ä»£ï¼Œæ˜ç¢ºä¸¦å¯¦ç¾éœ€æ±‚ã€‚åœ¨è‘—æ‰‹ä»»ä½•è¨­è¨ˆæˆ–ç·¨ç¢¼å·¥ä½œå‰ï¼Œå¿…é ˆå®Œæˆå‰æœŸèª¿ç ”ä¸¦é‡æ¸…æ‰€æœ‰ç–‘é»ï¼Œéœ€åƒè€ƒå…ˆå‰è³‡æ–™æˆ–ç­†è¨˜ã€‚
- **çµæ§‹åŒ–æµç¨‹**ï¼šåš´æ ¼éµå¾ªã€Œæ§‹æ€æ–¹æ¡ˆ â†’ æç…‰éª¨æ¶ â†’ åˆ†è§£ç‚ºå…·é«”ä»»å‹™ã€çš„ä½œæ¥­é †åºã€‚
- **ç‰ˆæœ¬ç¢ºèªè¦å‰‡** â­ï¼šå‡¡å»ºæ§‹**æ ¸å¿ƒæŠ€è¡“å…ƒä»¶**æˆ–**éƒ¨ç½²ç’°å¢ƒ**æ™‚ï¼Œå¿…é ˆï¼š
  1. âœ… å…ˆä¸Šç¶²æŸ¥è©¢è©²æŠ€è¡“/æ¡†æ¶çš„**æœ€æ–°ç©©å®šç‰ˆæœ¬** (LTS / Stable)
  2. âœ… èˆ‡ä½¿ç”¨è€…ç¢ºèªç‰ˆæœ¬å¾Œå†æ–½åš
  - **é©ç”¨ç¯„åœ**ï¼šNode.jsã€Pythonã€Docker åŸºåº•æ˜ åƒã€è³‡æ–™åº«ç‰ˆæœ¬ã€ä¸»è¦æ¡†æ¶ç‰ˆæœ¬ (Next.js, Flask, Payload CMS ç­‰)
  - **ç¦æ­¢äº‹é …**ï¼šâŒ ç›´æ¥ä½¿ç”¨æœ¬åœ°ç’°å¢ƒç‰ˆæœ¬æˆ–æ†‘å°è±¡æŒ‡å®šç‰ˆæœ¬

### 1.3 AI + MCP + Skills æ¶æ§‹åŸå‰‡ â­

> **æ ¸å¿ƒç†å¿µ**ï¼šæ¡ç”¨ã€ŒAI æ ¸å¿ƒ + MCP Server + Skills æ¨¡çµ„ã€ä¸‰å±¤æ¶æ§‹ï¼Œè®“ AI é€éæ¨™æº–åŒ–å”è­°é€£æ¥å¤–éƒ¨å·¥å…·èˆ‡æ•¸æ“šæºï¼Œä¸¦é€éæ¨¡çµ„åŒ–çš„ Skills å°è£æ¥­å‹™é‚è¼¯ã€‚

**æ•´é«”æ¶æ§‹**ï¼š

```
ç”¨æˆ¶è¨Šæ¯
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Core (Gemini / GPT)                                 â”‚
â”‚  â€¢ System Prompt                                        â”‚
â”‚  â€¢ Function Calling / Tool Use                          â”‚
â”‚  â€¢ æ„åœ–è­˜åˆ¥èˆ‡å›è¦†ç”Ÿæˆ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCP Servers        â”‚   â”‚  Skills (æ¨¡çµ„åŒ–æŠ€èƒ½)  â”‚
â”‚  (å¤–éƒ¨æ•¸æ“šæº)        â”‚   â”‚  (æ¥­å‹™é‚è¼¯å°è£)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ PMS API           â”‚   â”‚ â€¢ ç•¶æ—¥è¨‚æˆ¿ Skill    â”‚
â”‚ â€¢ Weather API       â”‚   â”‚ â€¢ è¨‚å–®æŸ¥è©¢ Skill    â”‚
â”‚ â€¢ Database          â”‚   â”‚ â€¢ VIP æœå‹™ Skill    â”‚
â”‚ â€¢ æˆ¿æ§ç³»çµ±           â”‚   â”‚ â€¢ å…§éƒ¨æŸ¥è©¢ Skill    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“                           â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ çµæœåˆä½µ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
              AI ç”Ÿæˆè‡ªç„¶å›è¦†
```

**ä¸‰å±¤æ¶æ§‹èªªæ˜**ï¼š

| å±¤ç´š   | åç¨±       | èªªæ˜                          | ç¯„ä¾‹                     |
| :----- | :--------- | :---------------------------- | :----------------------- |
| **L1** | AI Core    | æ„åœ–è­˜åˆ¥ã€å°è©±ç®¡ç†ã€å›è¦†ç”Ÿæˆ  | Gemini + System Prompt   |
| **L2** | MCP Server | å¤–éƒ¨ API/è³‡æ–™åº«çš„æ¨™æº–åŒ–é€£æ¥å™¨ | PMS MCPã€Weather MCP     |
| **L3** | Skills     | å¯é‡ç”¨çš„æ¥­å‹™é‚è¼¯æ¨¡çµ„          | `same_day_booking.skill` |

**MCP Server è¦ç¯„**ï¼š

- **å®šç¾©**ï¼šModel Context Protocol Serverï¼Œæä¾› AI å­˜å–å¤–éƒ¨è³‡æºçš„æ¨™æº–ä»‹é¢
- **å„ªé»**ï¼šè§£è€¦ AI èˆ‡å¤–éƒ¨ç³»çµ±ï¼Œæ˜“æ–¼æ“´å……èˆ‡æ›¿æ›
- **å¯¦ä½œæ–¹å¼**ï¼šæ¯å€‹ MCP Server ç¨ç«‹éƒ¨ç½²ï¼Œé€éæ¨™æº– JSON-RPC é€šè¨Š

**Skills æ¨¡çµ„åŒ–è¦ç¯„**ï¼š

- **å®šç¾©**ï¼šå°è£ç‰¹å®šæ¥­å‹™æµç¨‹çš„å¯é‡ç”¨æ¨¡çµ„
- **çµæ§‹**ï¼šæ¯å€‹ Skill å¿…é ˆåŒ…å« `SKILL.md` èªªæ˜æ–‡ä»¶
- **æ ¸å¿ƒåŸå‰‡**ï¼š
  - âœ… **å–®ä¸€è·è²¬**ï¼šä¸€å€‹ Skill åªè™•ç†ä¸€ç¨®æ¥­å‹™æµç¨‹
  - âœ… **è‡ªåŒ…å«**ï¼šSkill å…§å«æ‰€éœ€çš„ç‹€æ…‹æ©Ÿã€é©—è­‰é‚è¼¯ã€å›è¦†æ¨¡æ¿
  - âœ… **å¯çµ„åˆ**ï¼šSkill å¯ä»¥å‘¼å«å…¶ä»– Skill æˆ– MCP Server
  - âœ… **å¯æ¸¬è©¦**ï¼šSkill å¯ä»¥ç¨ç«‹æ¸¬è©¦ï¼Œä¸ä¾è³´å…¶ä»–æ¨¡çµ„

**Skill ç›®éŒ„çµæ§‹è¦ç¯„**ï¼š

```
skills/
â”œâ”€â”€ same_day_booking/           # ç•¶æ—¥è¨‚æˆ¿ Skill
â”‚   â”œâ”€â”€ SKILL.md                # å¿…é ˆï¼šSkill èªªæ˜æ–‡ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ machine.py              # ç‹€æ…‹æ©Ÿé‚è¼¯
â”‚   â”œâ”€â”€ validators.py           # é©—è­‰å™¨ (é›»è©±ã€æ—¥æœŸç­‰)
â”‚   â”œâ”€â”€ templates.py            # å›è¦†æ¨¡æ¿
â”‚   â””â”€â”€ tests/                  # å–®å…ƒæ¸¬è©¦
â”‚       â””â”€â”€ test_machine.py
â”œâ”€â”€ order_query/                # è¨‚å–®æŸ¥è©¢ Skill
â”‚   â”œâ”€â”€ SKILL.md
â”‚   â””â”€â”€ ...
â””â”€â”€ vip_service/                # VIP æœå‹™ Skill
    â”œâ”€â”€ SKILL.md
    â””â”€â”€ ...
```

**SKILL.md å¿…è¦å…§å®¹**ï¼š

```markdown
# [Skill åç¨±]

## åŠŸèƒ½æè¿°

ä¸€å¥è©±èªªæ˜æ­¤ Skill çš„ç”¨é€”

## è§¸ç™¼æ¢ä»¶

- é—œéµå­—ï¼š...
- æ„åœ–ï¼š...

## ç‹€æ…‹æµç¨‹

idle â†’ collecting_info â†’ confirming â†’ completed

## è¼¸å…¥åƒæ•¸

| åƒæ•¸  | é¡å‹ | å¿…å¡« | èªªæ˜     |
| :---- | :--- | :--- | :------- |
| phone | str  | âœ…   | è¯çµ¡é›»è©± |

## è¼¸å‡ºæ ¼å¼

æˆåŠŸ/å¤±æ•—çš„å›è¦†æ¨¡æ¿

## ä¾è³´

- MCP Server: PMS API
- å…¶ä»– Skill: ç„¡
```

**æ¨¡çµ„åŒ–é–‹ç™¼æµç¨‹**ï¼š

1. **å»ºç«‹ç›®éŒ„**ï¼šåœ¨ `skills/` ä¸‹å»ºç«‹æ–°çš„ Skill ç›®éŒ„
2. **æ’°å¯« SKILL.md**ï¼šå®šç¾©åŠŸèƒ½ã€ç‹€æ…‹æµç¨‹ã€è¼¸å…¥è¼¸å‡º
3. **å¯¦ä½œç‹€æ…‹æ©Ÿ**ï¼šåœ¨ `machine.py` ä¸­å¯¦ä½œæ ¸å¿ƒé‚è¼¯
4. **æ’°å¯«æ¸¬è©¦**ï¼šåœ¨ `tests/` ä¸­æ’°å¯«å–®å…ƒæ¸¬è©¦
5. **è¨»å†Šè‡³ä¸»è·¯ç”±**ï¼šåœ¨ `bot.py` ä¸­è¨»å†Šæ–° Skill

**æŒçºŒå„ªåŒ–æ–¹å¼**ï¼š

1. **æ–°å¢ Skill**ï¼šå°è£æ–°æ¥­å‹™æµç¨‹ç‚ºç¨ç«‹æ¨¡çµ„
2. **æ–°å¢ MCP Server**ï¼šé€£æ¥æ–°çš„å¤–éƒ¨æ•¸æ“šæº
3. **èª¿æ•´ System Prompt**ï¼šå„ªåŒ– AI åˆ¤æ–·é‚è¼¯
4. **ç´¯ç©çŸ¥è­˜åº«**ï¼šè±å¯Œ FAQ èˆ‡æ¥­å‹™çŸ¥è­˜
5. **åˆ†æå°è©±æ—¥èªŒ**ï¼šæ‰¾å‡º AI èª¤åˆ¤æ¡ˆä¾‹ä¸¦ä¿®æ­£

**ç¦æ­¢äº‹é …**ï¼š

- âŒ ä¸ä½¿ç”¨**è„«é›¢ AI ç†è§£**çš„ç´”ç¡¬ç·¨ç¢¼ç‹€æ…‹æ©Ÿï¼ˆæ‡‰è©²å…ˆé€é AI åˆ¤å®šæ„åœ–ï¼Œå†ç”±ç‹€æ…‹æ©Ÿæ¥æ‰‹æµç¨‹ï¼‰
- âŒ ä¸ä½¿ç”¨ç¡¬ç·¨ç¢¼æ­£å‰‡è¡¨é”å¼å–ä»£ AI ç†è§£ï¼ˆåƒ…èƒ½åœ¨ AI å¤±æ•—æ™‚ä½œç‚ºè¼”åŠ©æ ¡é©—ï¼‰
- âŒ ä¸ç¹é AI æŒ‡ä»¤ç›´æ¥å¼·è¡Œè·³è½‰æ¨¡çµ„ï¼ˆé™¤éæ˜¯ç³»çµ±ç´šé‡ç½®ï¼‰
- âŒ ä¸å°‡ AI é‚è¼¯èˆ‡å¤–éƒ¨ API ç›´æ¥è€¦åˆï¼ˆå¿…é ˆé€é MCP Server éš”é›¢ï¼‰

### 1.4 å°è©±ç³»çµ±æ¶æ§‹åŸå‰‡ï¼šæ¨¡çµ„åŒ–ç‹€æ…‹æ©Ÿ (Modular FSM) â­

> **é©ç”¨ç¯„åœ**ï¼šæœ¬åŸå‰‡å°ˆç”¨æ–¼ `LINEBOT` (bot.py) ç­‰éœ€è¦è™•ç†è¤‡é›œã€æœ‰ç‹€æ…‹ä¹‹å°è©±æµç¨‹çš„çµ„ä»¶ã€‚
>
> **æ ¸å¿ƒç†å¿µ**ï¼šçµåˆã€Œç¢ºå®šæ€§çš„ç‹€æ…‹æ©Ÿã€ä»¥ä¿è­‰å•†å‹™é‚è¼¯å®‰å…¨ï¼Œä¸¦è¼”ä»¥ã€Œéˆæ´»çš„ AI å·¥å…·èª¿ç”¨ã€æå‡æœå‹™æº«åº¦ã€‚

**ä¸»è¦çµ„ä»¶**ï¼š

1.  **ç‹€æ…‹æ©Ÿå°å‘ (State-Machine Driven)**ï¼šä½¿ç”¨ `ConversationStateMachine` é€²è¡Œ Session ç®¡ç†ã€‚é€™ä¸æ˜¯ç‚ºäº†å–ä»£ AIï¼Œè€Œæ˜¯ç‚ºäº†åœ¨ AI åˆ¤å®šæ„åœ–å¾Œï¼Œ**å¼·åˆ¶ç¢ºä¿å•†å‹™æµç¨‹çš„å®Œæ•´æ€§**ï¼ˆå¦‚è¨‚å–®ç¢ºèªå¿…é ˆç¶“éé›»è©±æ ¡é©—ï¼‰ã€‚
2.  **è™•ç†å™¨å§”æ´¾æ¨¡å¼ (Handler Delegation Pattern)**ï¼š`bot.py` ä¸»è·¯ç”±åƒ…è² è²¬æ„åœ–åˆ†ç™¼ã€‚å„åŠŸèƒ½å¡Šï¼ˆå¦‚ `OrderQueryHandler`, `VIPServiceHandler`ï¼‰å„è‡ªç¨ç«‹ç®¡ç†å…¶å…§éƒ¨çš„ä»»å‹™é‚è¼¯ã€‚
3.  **å·¥å…·èª¿ç”¨æ¨¡å‹ (Tool-Calling)**ï¼šé€™æ˜¯ AI çš„åŸ·è¡Œæ‰‹è…³ã€‚ç•¶ç‹€æ…‹è™•æ–¼é–’ç½® (`idle`) æ™‚ï¼Œç”± AI æ ¹æ“šå®¢äººçš„è‡ªç„¶èªè¨€è‡ªä¸»æ±ºå®šèª¿ç”¨å“ªäº› toolsï¼ˆå¦‚ `update_guest_info`ï¼‰ã€‚
4.  **MCP æ•´åˆ**ï¼šå¤–éƒ¨ API å‘¼å«é€é MCP Server é€²è¡Œï¼Œç¢ºä¿ AI èˆ‡å¤–éƒ¨ç³»çµ±è§£è€¦ã€‚

**æ¶æ§‹å„ªå‹¢**ï¼š

- **å®‰å…¨èˆ‡ç©©å¥**ï¼šç‹€æ…‹æ©Ÿä¿è­‰äº†é—œéµæ¬„ä½ä¸éºæ¼ã€ä¸å¹»è¦ºã€‚
- **éˆæ´»æ€§**ï¼šéé—œéµæµç¨‹ç”± AI ä»£ç†è™•ç†ï¼Œæå‡å°è©±çš„è‡ªç„¶åº¦èˆ‡æ‡‰è®Šèƒ½åŠ›ã€‚
- **å¯æ“´å±•æ€§**ï¼šæ–°å¢åŠŸèƒ½åªéœ€å»ºç«‹æ–°çš„ Skill ä¸¦è¨»å†Šè‡³è·¯ç”±ï¼Œä¸æœƒæ±™æŸ“ç¾æœ‰é‚è¼¯ã€‚
- **æŒä¹…åŒ–æ”¯æ´**ï¼šçµåˆ SQLite å¯¦ç¾é•·æ•ˆ Sessionï¼Œä¸­æ–·å¾Œå¯ç„¡ç¸«éŠœæ¥ã€‚
- **æ¨™æº–åŒ–é€£æ¥**ï¼šé€é MCP å”è­°é€£æ¥å¤–éƒ¨ç³»çµ±ï¼Œæ˜“æ–¼æ›¿æ›èˆ‡ç¶­è­·ã€‚

### 1.5 SaaS å¤šç§Ÿæˆ¶æ¶æ§‹ â­

> **é©ç”¨ç¯„åœ**ï¼šktw-saas-platform (Payload CMS)ã€ktw-saas-bot (LINE Bot) çš„å¤šç§Ÿæˆ¶ SaaS é–‹ç™¼ã€‚
>
> **æ ¸å¿ƒç†å¿µ**ï¼šä»¥ Payload CMS ç‚º SaaS æ ¸å¿ƒå¹³å°ï¼Œé€éç§Ÿæˆ¶éš”é›¢æ©Ÿåˆ¶ï¼Œè®“å¤šå€‹é£¯åº—å®¢æˆ¶å…±ç”¨åŒä¸€å¥—ç³»çµ±ã€‚

**SaaS æ•´é«”æ¶æ§‹**ï¼š

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚      Zeabur Cloud (æ—¥æœ¬)     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                             â†“                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Payload CMS      â”‚   â”‚  SaaS Bot         â”‚   â”‚  PostgreSQL       â”‚
â”‚  (ç®¡ç†å¹³å°)        â”‚   â”‚  (å¤šç§Ÿæˆ¶ Bot)      â”‚   â”‚  (å…±äº«è³‡æ–™åº«)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç§Ÿæˆ¶ç®¡ç†        â”‚   â”‚ â€¢ ç§Ÿæˆ¶è·¯ç”±        â”‚   â”‚ â€¢ RLS éš”é›¢        â”‚
â”‚ â€¢ ç”¨æˆ¶èªè­‰        â”‚   â”‚ â€¢ Skills èª¿ç”¨     â”‚   â”‚ â€¢ Schema éš”é›¢     â”‚
â”‚ â€¢ é…ç½®ç®¡ç†        â”‚   â”‚ â€¢ AI å°è©±è™•ç†     â”‚   â”‚ â€¢ å°è©±æ—¥èªŒ        â”‚
â”‚ â€¢ Usage è¿½è¹¤      â”‚   â”‚ â€¢ MCP æ•´åˆ        â”‚   â”‚ â€¢ ç”¨é‡çµ±è¨ˆ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â”‚     Webhook URL       â”‚
        â”‚   /webhook/:tenant_id â”‚
        â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç§Ÿæˆ¶ (é£¯åº—å®¢æˆ¶)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   KTW Hotel   â”‚   Hotel A     â”‚   Hotel B     â”‚   Hotel C ...     â”‚
â”‚   tenant_001  â”‚   tenant_002  â”‚   tenant_003  â”‚   tenant_004      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**SaaS åˆ†å±¤æ¶æ§‹**ï¼š

| å±¤ç´š         | çµ„ä»¶             | éƒ¨ç½²ä½ç½®          | éš”é›¢ç­–ç•¥           |
| :----------- | :--------------- | :---------------- | :----------------- |
| **å¹³å°å±¤**   | Payload CMS      | Zeabur (æ°¸ä¹…)     | å…±äº«ï¼Œç”¨æˆ¶æ¬Šé™éš”é›¢ |
| **æœå‹™å±¤**   | SaaS Bot         | Zeabur â†’ è‡ªæ¶ä¸»æ©Ÿ | ç§Ÿæˆ¶è·¯ç”±éš”é›¢       |
| **æ•¸æ“šå±¤**   | PostgreSQL (CMS) | Zeabur            | å…±äº«               |
| **æ•¸æ“šå±¤**   | PostgreSQL (Bot) | è‡ªæ¶ä¸»æ©Ÿ          | RLS / Schema éš”é›¢  |
| **å¤–éƒ¨æ•´åˆ** | PMS MCP Server   | å„é£¯åº—æœ¬åœ°        | å®Œå…¨éš”é›¢           |

**ç§Ÿæˆ¶éš”é›¢ç­–ç•¥**ï¼š

| å®¢æˆ¶è¦æ¨¡     | éš”é›¢æ–¹å¼                 | èªªæ˜                              |
| :----------- | :----------------------- | :-------------------------------- |
| **å°å‹å®¢æˆ¶** | Row-Level Security (RLS) | å…±äº«è¡¨æ ¼ï¼Œç”¨ `tenant_id` æ¬„ä½éš”é›¢ |
| **ä¸­å‹å®¢æˆ¶** | Schema éš”é›¢              | æ¯å€‹ç§Ÿæˆ¶ç¨ç«‹ Schema               |
| **ä¼æ¥­å®¢æˆ¶** | Database éš”é›¢            | å®Œå…¨ç¨ç«‹è³‡æ–™åº«å¯¦ä¾‹                |

**Payload CMS ç§Ÿæˆ¶ç®¡ç†**ï¼š

```typescript
// Tenants Collection è¨­è¨ˆ
{
  slug: 'tenants',
  fields: [
    { name: 'name', type: 'text' },           // é£¯åº—åç¨±
    { name: 'tenant_id', type: 'text' },      // ç§Ÿæˆ¶ ID
    { name: 'subdomain', type: 'text' },      // å­ç¶²åŸŸ
    { name: 'line_channel_token', type: 'text', admin: { hidden: true } },
    { name: 'gemini_api_key', type: 'text', admin: { hidden: true } },
    {
      name: 'usage',
      type: 'group',
      fields: [
        { name: 'tokens_used_today', type: 'number' },
        { name: 'tokens_used_month', type: 'number' },
        { name: 'daily_limit', type: 'number' },
      ]
    },
    { name: 'status', type: 'select', options: ['active', 'suspended', 'trial'] }
  ]
}
```

**Bot ç§Ÿæˆ¶è·¯ç”±**ï¼š

```python
# ç§Ÿæˆ¶è·¯ç”±è¨­è¨ˆ
@app.route("/webhook/<tenant_id>", methods=['POST'])
def webhook(tenant_id):
    # å¾ Payload CMS è¼‰å…¥ç§Ÿæˆ¶é…ç½®
    tenant = payload_api.get_tenant(tenant_id)

    # ä½¿ç”¨ç§Ÿæˆ¶å°ˆå±¬çš„ LINE Token å’Œ AI è¨­å®š
    config = TenantConfig(tenant)

    # è™•ç†è¨Šæ¯
    return handle_message(request, config)
```

**SaaS é–‹ç™¼è¦ç¯„**ï¼š

1. **ç§Ÿæˆ¶æ„è­˜**ï¼š

   - âœ… æ‰€æœ‰è³‡æ–™æ“ä½œå¿…é ˆå¸¶ `tenant_id`
   - âœ… API è«‹æ±‚å¿…é ˆé©—è­‰ç§Ÿæˆ¶æ¬Šé™
   - âŒ ç¦æ­¢è·¨ç§Ÿæˆ¶è³‡æ–™å­˜å–

2. **é…ç½®ç®¡ç†**ï¼š

   - ç§Ÿæˆ¶é…ç½®å­˜æ”¾æ–¼ Payload CMS
   - æ•æ„Ÿè³‡è¨Šï¼ˆAPI Keyï¼‰åŠ å¯†å­˜å„²
   - Bot å‹•æ…‹è¼‰å…¥ç§Ÿæˆ¶é…ç½®

3. **ç”¨é‡è¿½è¹¤**ï¼š
   - æ¯æ¬¡ AI å‘¼å«è¨˜éŒ„ Token ç”¨é‡
   - é”åˆ°é™é¡æ™‚é™ç´šæˆ–æš«åœæœå‹™
   - æœˆåº•è‡ªå‹•é‡ç½®ç”¨é‡

**PMS æ•´åˆè¦ç¯„**ï¼š

- **é˜²è…å±¤ (ACL)**ï¼šçµ•ä¸è®“ PMS çš„æ¬„ä½å‘½åæ±™æŸ“æ–°ç³»çµ±
  - `IKEY` â†’ `bookingId`
  - `GUEST_MN` â†’ `GuestProfile`
  - `CI_DAT` â†’ `checkInDate`
- **MCP Server å°è£**ï¼šæ¯å€‹é£¯åº—çš„ PMS é€éç¨ç«‹ MCP Server é€£æ¥
- **è³‡æ–™åŒæ­¥**ï¼šæ¡ç”¨é›™è»Œä¸¦è¡Œç­–ç•¥ (è©³è¦‹ç¬¬ 6 ç« )

### 1.6 Zeabur ä½œæ¥­åŸå‰‡ â­

> **æ ¸å¿ƒç†å¿µ**ï¼šéå¿…è¦ä¸ä½¿ç”¨ç€è¦½å™¨æ“ä½œ Zeaburï¼Œå„ªå…ˆä½¿ç”¨ CLI å‘½ä»¤è¡Œå·¥å…·ã€‚

**ç‚ºä»€éº¼ä½¿ç”¨ CLI**ï¼š

| ä½œæ¥­æ–¹å¼       | å„ªé»                         | ç¼ºé»                   |
| :------------- | :--------------------------- | :--------------------- |
| **CLI (å„ªå…ˆ)** | å¯è‡ªå‹•åŒ–ã€å¯é‡è¤‡åŸ·è¡Œã€æœ‰è¨˜éŒ„ | å­¸ç¿’æ›²ç·š               |
| **ç€è¦½å™¨**     | ç›´è§€ã€æ˜“ä¸Šæ‰‹                 | ç„¡æ³•è‡ªå‹•åŒ–ã€ç„¡æ“ä½œè¨˜éŒ„ |

**CLI è¨­å®š (é¦–æ¬¡ä½¿ç”¨)**ï¼š

```bash
# ç™»å…¥ Zeabur
npx zeabur auth login

# è¨­å®šå°ˆæ¡ˆ Context (åªéœ€è¨­å®šä¸€æ¬¡)
source ~/ktw-projects/zeabur-switch.sh platform  # æˆ– bot / db
```

**å¸¸ç”¨ CLI ä½œæ¥­**ï¼š

| ä½œæ¥­         | CLI å‘½ä»¤                                                 |
| :----------- | :------------------------------------------------------- |
| æŸ¥çœ‹ Logs    | `npx zeabur deployment log -t runtime \| tail -100`      |
| å³æ™‚ç›£æ§     | `npx zeabur deployment log -t runtime -w`                |
| é‡å•Ÿæœå‹™     | `npx zeabur service restart --id=<ID> -y`                |
| æŸ¥çœ‹ç’°å¢ƒè®Šæ•¸ | `npx zeabur variable list --id=<ID>`                     |
| æ›´æ–°ç’°å¢ƒè®Šæ•¸ | `npx zeabur variable update --id=<ID> -k "KEY=value" -y` |
| æŸ¥çœ‹è³‡æºä½¿ç”¨ | `npx zeabur service metric CPU --id=<ID> -H 2`           |

**æœå‹™ ID å°ç…§**ï¼š

| æœå‹™åç¨±          | Service ID                 |
| :---------------- | :------------------------- |
| ktw-saas-platform | `69509aa57ab28c100bbc0aa7` |
| ktw-saas-bot      | `69509ae97ab28c100bbc0abc` |
| postgresql        | `6950c2a2479879e7ecdb006c` |

**ä½•æ™‚å¯ä½¿ç”¨ç€è¦½å™¨**ï¼š

- âœ… é¦–æ¬¡è¨­å®š OAuth Callback URLï¼ˆéœ€è¦ UI æ“ä½œï¼‰
- âœ… é¦–æ¬¡ç¶å®šè‡ªè¨‚ç¶²åŸŸ DNS
- âœ… æŸ¥çœ‹å®Œæ•´ Deployment æ­·å²
- âŒ æŸ¥çœ‹ Logsï¼ˆä½¿ç”¨ CLIï¼‰
- âŒ ä¿®æ”¹ç’°å¢ƒè®Šæ•¸ï¼ˆä½¿ç”¨ CLIï¼‰
- âŒ é‡å•Ÿæœå‹™ï¼ˆä½¿ç”¨ CLIï¼‰

**Workflow æ–‡ä»¶**ï¼š

è©³ç´°å‘½ä»¤è«‹åƒè€ƒ `.agent/workflows/zeabur-logs.md` å’Œ `.agent/workflows/zeabur-cli-reference.md`

**éŒ¯èª¤ä¿®å¾©è¨˜éŒ„è¦ç¯„** â­ï¼š

> [!IMPORTANT]
> ä»»ä½• Zeabur ç›¸é—œçš„éŒ¯èª¤èˆ‡ä¿®å¾©ï¼Œ**å¿…é ˆè©³ç´°è¨˜éŒ„**ã€‚

**è¨˜éŒ„ä½ç½®**ï¼š`ktw-saas-platform/CHANGELOG.md` æˆ–ç›¸é—œå°ˆæ¡ˆçš„ CHANGELOG

**å¿…è¦è¨˜éŒ„é …ç›®**ï¼š

| é …ç›®           | èªªæ˜              | ç¯„ä¾‹                                            |
| :------------- | :---------------- | :---------------------------------------------- |
| **éŒ¯èª¤ç¾è±¡**   | ç™¼ç”Ÿäº†ä»€éº¼å•é¡Œ    | `missing secret key` éŒ¯èª¤å°è‡´ 404               |
| **ç™¼ç¾æ™‚é–“**   | ä½•æ™‚ç™¼ç¾          | 2025-12-29 21:20                                |
| **æ ¹æœ¬åŸå› **   | ç‚ºä»€éº¼æœƒç™¼ç”Ÿ      | `PAYLOAD_SECRET` èˆ‡ `DATABASE_URL` ä¸²æ¥åœ¨åŒä¸€è¡Œ |
| **å½±éŸ¿ç¯„åœ**   | å½±éŸ¿äº†ä»€éº¼åŠŸèƒ½    | æ‰€æœ‰é é¢ç„¡æ³•è¼‰å…¥ï¼ŒOAuth ç™»å…¥å¤±æ•—                |
| **ä¿®å¾©æ–¹å¼**   | åšäº†ä»€éº¼ä¿®å¾©      | åœ¨ç’°å¢ƒè®Šæ•¸ç·¨è¼¯å™¨ä¸­åˆ†è¡Œä¸¦é‡å•Ÿ                    |
| **é©—è­‰çµæœ**   | ä¿®å¾©å¾Œçš„ç¢ºèª      | `âœ“ Ready in 539ms`ï¼Œé é¢æ­£å¸¸è¼‰å…¥                |
| **ä½¿ç”¨çš„å‘½ä»¤** | ç”¨äº†å“ªäº› CLI å‘½ä»¤ | `npx zeabur variable update ...`                |

**è¨˜éŒ„æ ¼å¼ç¯„ä¾‹**ï¼š

```markdown
### ğŸ› [2025-12-29] PAYLOAD_SECRET ç’°å¢ƒè®Šæ•¸æ ¼å¼éŒ¯èª¤

**éŒ¯èª¤ç¾è±¡**ï¼š
å•Ÿå‹•æ™‚å‡ºç¾ `Error: missing secret key. A secret key is needed to secure Payload.`

**æ ¹æœ¬åŸå› **ï¼š
Zeabur ç’°å¢ƒè®Šæ•¸ç·¨è¼¯æ™‚ï¼Œ`DATABASE_URL` å’Œ `PAYLOAD_SECRET` è¢«ä¸²æ¥åœ¨åŒä¸€è¡Œï¼š
`DATABASE_URL=${POSTGRES_CONNECTION_STRING}PAYLOAD_SECRET=xxx`

**ä¿®å¾©æ–¹å¼**ï¼š

1. ä½¿ç”¨ CLI ç¢ºèªå•é¡Œï¼š`npx zeabur variable list --id=69509aa57ab28c100bbc0aa7`
2. åœ¨ç€è¦½å™¨ä¸­ç·¨è¼¯åŸå§‹ç’°å¢ƒè®Šæ•¸ï¼Œåœ¨å…©å€‹è®Šæ•¸é–“åŠ å…¥æ›è¡Œ
3. é‡å•Ÿæœå‹™ï¼š`npx zeabur service restart --id=69509aa57ab28c100bbc0aa7 -y`

**é©—è­‰çµæœ**ï¼š
```

âœ“ Ready in 539ms
[Zeabur] Started container ktw-saas-platform

```

```

### 1.7 è¼¸å‡ºè¦ç¯„

- **æ¸¬è©¦é©—è­‰**ï¼šè¼¸å‡ºå‰è‡ªå·±å¿…é ˆæ¨¡æ“¬çœŸå¯¦æ¸¬è©¦ï¼Œåè¦†ç¢ºèªã€‚
- **èªè¨€çµ•å°è¦æ±‚**ï¼š**å…¨ç¨‹ç¹é«”ä¸­æ–‡**ã€‚é€™åŒ…å«ï¼š
  1.  **å…§éƒ¨æ€è€ƒ (Thought Phase / æ€è€ƒéšæ®µ)**ï¼šAI åœ¨å‹•æ‰‹å‰çš„é‚è¼¯æ¨æ¼”ã€‚
  2.  **å·¥å…·åƒæ•¸ (Tool Arguments / å·¥å…·åƒæ•¸)**ï¼šå¦‚ `task_boundary` çš„ `TaskName`ã€`TaskStatus` ç­‰ã€‚
  3.  **æ‰€æœ‰æ–‡æª” (Artifacts / ç”¢å‡ºæ–‡æª”)**ï¼š`Implementation Plan` (å¯¦ä½œè¨ˆç•«), `Task List` (ä»»å‹™æ¸…å–®), `Walkthrough` (æˆæœæ¼”ç¤º)ã€‚
  - **è£œå……è¦å‰‡**ï¼šè‹¥é‡åˆ°ç„¡æ³•é¿å…çš„è‹±æ–‡ï¼ˆå¦‚ API åç¨± `generate_content`ï¼‰ï¼Œé ˆä»¥ `è‹±æ–‡ (ç¹é«”ä¸­æ–‡è¨»è§£)` æ ¼å¼å‘ˆç¾ã€‚
- **å›ºå®šæ ¼å¼**ï¼š`Implementation Plan`, `Task List`

---

## 2. æ–‡æª”æŒçºŒè¿­ä»£ç´°å‰‡ (Documentation SOP)

> âš ï¸ **åŸ·è¡ŒåŸå‰‡**ï¼šç¨‹å¼ç¢¼èˆ‡æ–‡æª”å¿…é ˆåŒæ­¥ã€‚ä»»ä½•åŠŸèƒ½è®Šæ›´è‹¥æœªåæ˜ åœ¨æ–‡æª”ä¸­ï¼Œå‰‡è¦–ç‚ºã€Œæœªå®Œæˆã€ã€‚

### 2.1 åŸ·è¡Œæ™‚æ©Ÿ

**ä¸€èˆ¬æ–‡æª”æ›´æ–°** (README, API è¦æ ¼, Guide):

- **æ¯æ¬¡ä»»å‹™çµæŸå‰** (åœ¨äº¤ä»˜æˆæœä¹‹å‰)
- ç•¶ä¿®æ”¹äº†æ ¸å¿ƒé‚è¼¯ã€API ä»‹é¢æˆ–ç’°å¢ƒè®Šæ•¸æ™‚

**CHANGELOG æ›´æ–°** (ç‰ˆæœ¬è¨˜éŒ„):

- ç™¼å¸ƒæ–°ç‰ˆæœ¬æ™‚ (è©³è¦‹ 2.2 ç¬¬ 5 é …)
- é‡å¤§åŠŸèƒ½è®Šæ›´ã€Bug ä¿®å¾©ã€ç ´å£æ€§è®Šæ›´æ™‚

### 2.2 è‡ªå‹•æª¢æŸ¥æ¸…å–® (Auto-Checklist)

AI ä»£ç†åœ¨çµæŸä»»å‹™å‰ï¼Œå¿…é ˆåŸ·è¡Œä»¥ä¸‹æª¢æŸ¥ï¼š

1.  **ç›®éŒ„ç´š README**

    - ä¿®æ”¹ `LINEBOT/` ç¨‹å¼ç¢¼ âœ æ›´æ–° `LINEBOT/README.md`
    - ä¿®æ”¹ `pms-api/` ç¨‹å¼ç¢¼ âœ æ›´æ–° `pms-api/README.md`
    - **é‡é»**ï¼šæ›´æ–°æ–°åŠŸèƒ½èªªæ˜ã€åƒæ•¸è®Šæ›´ã€ä¾è³´é …ã€‚

2.  **API è¦æ ¼æ–‡æª”**

    - è®Šæ›´ API ä»‹é¢/æ ¼å¼ âœ æ›´æ–° `pms-api/PMS-DATABASE-REFERENCE.md`ã€‚
    - ç¢ºä¿ `PMS-DATABASE-REFERENCE.md` ç‚ºè³‡æ–™åº«çµæ§‹çš„ **å–®ä¸€çœŸå¯¦ä¾†æº (SSOT)**ã€‚

3.  **ç’°å¢ƒè®Šæ•¸**

    - æ–°å¢ `.env` è®Šæ•¸ âœ åŒæ­¥æ›´æ–° `.env.example`ã€‚

4.  **é€£çµå®Œæ•´æ€§**

    - ç§»å‹•/é‡å‘½åæ–‡ä»¶ âœ å…¨åŸŸæœå°‹ä¸¦ä¿®å¾©æ‰€æœ‰æ–·è£‚çš„ Markdown é€£çµã€‚

5.  **å¾…è¾¦åŠŸèƒ½è¨˜éŒ„ (TODO.md)** â­

    - **é©ç”¨æ™‚æ©Ÿ**ï¼šé‡åˆ°**å·¥ç¨‹è¼ƒå¤§**æˆ–**ç‰½é€£è¼ƒå»£**çš„åŠŸèƒ½éœ€æ±‚ï¼Œç„¡æ³•ç«‹å³å®Œæˆæ™‚
    - **å¼·åˆ¶è¦å®š**ï¼šå¿…é ˆè¨˜éŒ„åˆ° `docs/TODO.md`
    - **è¨˜éŒ„å…§å®¹**ï¼ˆä½¿ç”¨è¡¨æ ¼æ ¼å¼ï¼‰ï¼š

    | é …ç›®         | èªªæ˜                                             |
    | :----------- | :----------------------------------------------- |
    | **ç‚ºä½•å®‰æ’** | è§¸ç™¼æ­¤å¾…è¾¦çš„äº‹ä»¶æˆ–è¨è«–ï¼ˆå¦‚æ—¥æœŸã€ç™¼ç¾å•é¡Œçš„æƒ…å¢ƒï¼‰ |
    | **å®‰æ’åŸå› ** | ç‚ºä»€éº¼éœ€è¦åšé€™ä»¶äº‹ï¼Œè§£æ±ºä»€éº¼å•é¡Œ                 |
    | **å½±éŸ¿ç¯„åœ** | æ¶‰åŠçš„æª”æ¡ˆ/æ¨¡çµ„/ç³»çµ±                             |
    | **æå‡ºæ—¥æœŸ** | YYYY-MM-DD                                       |

    - **ç›®çš„**ï¼šé¿å…éºå¿˜ã€æ–¹ä¾¿å¾ŒçºŒè¿½è¹¤èˆ‡è¦åŠƒ

    **TODO æ ¼å¼ç¯„ä¾‹**ï¼š

    ```markdown
    ### 1. é…ç½® SMTP éƒµä»¶æœå‹™

    | é …ç›®         | èªªæ˜                                                           |
    | :----------- | :------------------------------------------------------------- |
    | **ç‚ºä½•å®‰æ’** | 2025-12-23 ç”¨æˆ¶æ¸¬è©¦å¿˜è¨˜å¯†ç¢¼åŠŸèƒ½ï¼Œç™¼ç¾éƒµä»¶ç„¡æ³•ç™¼é€              |
    | **å®‰æ’åŸå› ** | Payload æœªé…ç½®éƒµä»¶æœå‹™ï¼Œé‡ç½®å¯†ç¢¼ä¿¡åªè¼¸å‡ºåˆ° Consoleï¼Œç”¨æˆ¶æ”¶ä¸åˆ° |
    | **å½±éŸ¿ç¯„åœ** | ç”¨æˆ¶å¿˜è¨˜å¯†ç¢¼æ™‚ç„¡æ³•è‡ªåŠ©é‡ç½®ï¼Œéœ€æ‰‹å‹•æ“ä½œè³‡æ–™åº«                   |
    | **æå‡ºæ—¥æœŸ** | 2025-12-23                                                     |

    **å­ä»»å‹™**ï¼š

    - [ ] é¸æ“‡ SMTP æœå‹™å•† (Gmail / SendGrid / Resend)
    - [ ] é…ç½® Payload email adapter
    ```

    **TODO ç”Ÿå‘½é€±æœŸç®¡ç†** â­

    > [!IMPORTANT] > **æ ¸å¿ƒåŸå‰‡**ï¼šæ‰€æœ‰æœªå®Œæˆäº‹é …èˆ‡è¨è«–çµæœæ±ºå®šåŸ·è¡Œçš„é …ç›®ï¼Œå¿…é ˆç¶“éã€Œè©¢å• â†’ è¨˜éŒ„ â†’ å®Œæˆ â†’ æ ¸å°ã€çš„å®Œæ•´æµç¨‹ã€‚

    **æµç¨‹æ­¥é©Ÿ**ï¼š

    1. **ç™¼ç¾æœªå®Œæˆäº‹é …æ™‚**

       - AI å¿…é ˆ**ä¸»å‹•è©¢å•**ï¼šã€Œæ˜¯å¦è¦å°‡æ­¤é …ç›®åŠ å…¥ TODOï¼Ÿã€
       - ä¾‹è¡Œå ´æ™¯ï¼šè¨è«–ä¸­æåˆ°çš„å¾…é–‹ç™¼åŠŸèƒ½ã€æ¸¬è©¦æœªé€šéçš„é …ç›®ã€æ™‚é–“é™åˆ¶ç„¡æ³•å®Œæˆçš„é …ç›®

    2. **åŠ å…¥ TODO æ™‚**

       - å¿…é ˆä½¿ç”¨ä¸Šè¿°è¡¨æ ¼æ ¼å¼ï¼Œè©³ç´°èªªæ˜**ç‚ºä½•å®‰æ’**èˆ‡**å®‰æ’åŸå› **
       - ä½¿ç”¨ `- [ ]` æ ¼å¼æ¨™è¨˜å­ä»»å‹™å¾…å®Œæˆ
       - **æ’°å¯«åŸå‰‡**ï¼š
         - âœ… **ç™½è©±**ï¼šç”¨ä¸€èˆ¬äººèƒ½æ‡‚çš„è©±æè¿°ï¼Œé¿å…éåº¦æŠ€è¡“è¡“èª
         - âœ… **æ¸…æ¥š**ï¼šèªªæ˜ç™¼ç”Ÿäº†ä»€éº¼ã€ç‚ºä»€éº¼æœƒç™¼ç”Ÿã€å½±éŸ¿äº†ä»€éº¼
         - âœ… **è©³ç´°**ï¼šåˆ—å‡ºç›¸é—œæª”æ¡ˆã€ç¨‹å¼ç¢¼ä½ç½®ã€éŒ¯èª¤è¨Šæ¯ç­‰å…·é«”è³‡è¨Š
       - **ç‰¹åˆ¥æ³¨æ„**ï¼šæœªè™•ç†å®Œå…¨çš„ Bug è¨˜éŒ„æ™‚ï¼Œå¿…é ˆè©³ç´°èªªæ˜ï¼š
         - ç•¶å‰ç‹€æ…‹ï¼ˆåšåˆ°å“ªè£¡ï¼Ÿå·®ä»€éº¼ï¼Ÿï¼‰
         - å¡é—œåŸå› ï¼ˆç‚ºä»€éº¼ç„¡æ³•å®Œæˆï¼Ÿï¼‰
         - ä¸‹æ¬¡ç¹¼çºŒçš„åˆ‡å…¥é»

    3. **å®Œæˆé …ç›®å¾Œ**

       - AI å¿…é ˆ**è‡ªå‹•æ ¸å°** `docs/TODO.md`ï¼Œç¢ºèªè©²é …ç›®æ˜¯å¦å·²è¨˜éŒ„
       - å¦‚å·²è¨˜éŒ„ï¼Œä½¿ç”¨**åˆªé™¤ç·š + æ‰“å‹¾**æ–¹å¼æ¨™è¨˜å®Œæˆï¼š
         ```markdown
         - ~~`bot.py` ç›®å‰ 1821 è¡Œï¼Œå¤ªè‚¥~~ âœ… å·²å®Œæˆ
         ```

    4. **çµæ¡ˆå‰æª¢æŸ¥**
       - AI å¿…é ˆæƒæ TODO.mdï¼Œç¢ºèªæœ¬æ¬¡å®Œæˆçš„é …ç›®éƒ½å·²æ­£ç¢ºæ¨™è¨˜

6.  **Bug è™•ç†è¨˜éŒ„ (Bug Fix Documentation)** â­

    > [!IMPORTANT] > **æ ¸å¿ƒåŸå‰‡**ï¼šæ‰€æœ‰ Bug è™•ç†å®Œæˆå¾Œï¼Œå¿…é ˆè¨˜éŒ„åˆ°**ç›¸å°æ‡‰å°ˆæ¡ˆçš„ `README.md` æœ€ä¸‹æ–¹**ï¼Œä½œç‚ºæ­·å²æ¡ˆä¾‹åƒè€ƒã€‚

    **åŸ·è¡Œæ™‚æ©Ÿ**ï¼š

    - âœ… Bug æˆåŠŸä¿®å¾©å¾Œ
    - âœ… å•é¡Œæš«æ™‚è§£æ±ºä½†éœ€å¾ŒçºŒè¿½è¹¤æ™‚ï¼ˆåŒæ™‚åŠ å…¥ TODOï¼‰

    **è¨˜éŒ„ä½ç½®**ï¼š

    - è¨˜éŒ„åˆ°**è©² Bug æ‰€å±¬å°ˆæ¡ˆ**çš„ `README.md` æœ€ä¸‹æ–¹
    - ç¯„ä¾‹ï¼š
      - Oracle é·ç§»ç›¸é—œ Bug â†’ `ktw-oracle-to-pg/README.md`
      - LINE Bot Bug â†’ `KTW-bot/LINEBOT/README.md`
      - Admin-Web Bug â†’ `KTW-bot/ktw-admin-web/README.md`

    **è¨˜éŒ„æ ¼å¼**ï¼š

    ```markdown
    ---
    
    ## ğŸ› å•é¡Œè™•ç†è¨˜éŒ„
    
    ### [YYYY-MM-DD] å•é¡Œæ¨™é¡Œ
    
    **å•é¡Œæè¿°**ï¼š
    ç”¨ç™½è©±èªªæ˜ç™¼ç”Ÿäº†ä»€éº¼äº‹
    
    **æ ¹æœ¬åŸå› **ï¼š
    ç‚ºä»€éº¼æœƒç™¼ç”Ÿé€™å€‹å•é¡Œ
    
    **è§£æ±ºæ–¹å¼**ï¼š
    å…·é«”åšäº†ä»€éº¼ä¿®å¾©
    
    **ç›¸é—œæª”æ¡ˆ**ï¼š
    - `path/to/file.py` (L123-145)
    
    **æ¸¬è©¦çµæœ**ï¼š
    ä¿®å¾©å¾Œçš„é©—è­‰çµæœ
    
    ---
    ```

    **æ³¨æ„äº‹é …**ï¼š

    - âŒ è‹¥å•é¡Œ**ç„¡æ³•å®Œå…¨è§£æ±º**ï¼Œå¿…é ˆåŒæ™‚åŠ å…¥ `TODO.md`
    - âŒ ç¦æ­¢åªå¯«ã€Œå·²ä¿®å¾©ã€è€Œä¸èªªæ˜åŸå› å’Œè§£æ³•
    - âœ… ä½¿ç”¨ç™½è©±æè¿°ï¼Œè®“æœªä¾†ç¶­è­·è€…èƒ½å¿«é€Ÿç†è§£

7.  **ç‰ˆæœ¬è®Šæ›´è¨˜éŒ„ (CHANGELOG)** â­

    - **æ¶æ§‹åŸå‰‡**ï¼šæ¡ç”¨ **Monorepo éšå±¤å¼è®Šæ›´æ—¥èªŒ**,æ ¹ç›®éŒ„æä¾›èšåˆæ‘˜è¦,å„æ¨¡çµ„ç¶­è­·è©³ç´°è¨˜éŒ„ã€‚
    - **åŸ·è¡Œæ™‚æ©Ÿ**ï¼š

      - âœ… ç™¼å¸ƒæ–°ç‰ˆæœ¬æ™‚ (æœ€é‡è¦)
      - âœ… æ–°å¢åŠŸèƒ½æ™‚
      - âœ… ä¿®å¾© Bug æ™‚
      - âœ… ç ´å£æ€§è®Šæ›´æ™‚ (Breaking Changes)
      - âœ… é‡å¤§å„ªåŒ–æ™‚
      - **è¨˜æ†¶æ³•**ï¼šå¦‚æœå€¼å¾—å¯«åœ¨ Git commit message,å°±å€¼å¾—å¯«åœ¨ CHANGELOG

    - **æ›´æ–°æµç¨‹**ï¼š
      1. å…ˆæ›´æ–°æ¨¡çµ„ CHANGELOG (å¦‚ `LINEBOT/CHANGELOG.md`)
      2. å†æ›´æ–°æ ¹ç›®éŒ„ `CHANGELOG.md` (ç°¡æ½”æ‘˜è¦ + é€£çµ)
    - **éµå¾ªåŸå‰‡**ï¼šSSOT (å–®ä¸€çœŸå¯¦ä¾†æº) + DRY (ä¸é‡è¤‡)
    - **æ¶æ§‹èªªæ˜**ï¼š
      ```
      /CHANGELOG.md              â† çµ±æ•´æ‰€æœ‰æ¨¡çµ„ (ç°¡æ½”æ ¼å¼)
      /LINEBOT/CHANGELOG.md      â† LINE Bot è©³ç´°è¨˜éŒ„
      /ktw-admin-web/CHANGELOG.md â† Admin Dashboard è©³ç´°è¨˜éŒ„
      /ktw-backend/CHANGELOG.md  â† Backend API è©³ç´°è¨˜éŒ„
      /pms-api/CHANGELOG.md      â† PMS API è©³ç´°è¨˜éŒ„
      ```

### 2.3 CHANGELOG ç·¨å¯«è¦ç¯„ â­

#### å¿…è¦å…ƒç´ 

æ¯å€‹ç‰ˆæœ¬è¨˜éŒ„å¿…é ˆåŒ…å«ï¼š

1. **ç‰ˆæœ¬è™Ÿèˆ‡æ—¥æœŸ**

   ```markdown
   ## [1.2.0] - 2025-12-17
   ```

   **ç‰ˆæœ¬è™Ÿç·¨æ’è¦å‰‡** (Semantic Versioning):

   - **æ ¼å¼**: `ä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è¨‚ç‰ˆæœ¬` (MAJOR.MINOR.PATCH)
   - **éå¢è¦å‰‡**: ç”±å‰ä¸€ç‰ˆæœ¬çš„**æœ€å°è™Ÿç‰ˆæœ¬ +1** é–‹å§‹ç·¨æ’

   **ç¯„ä¾‹**:

   ```
   v1.1.6 (å‰ä¸€ç‰ˆæœ¬)
     â†“
   v1.1.7 (Bug ä¿®å¾©) â† ä¿®è¨‚ç‰ˆæœ¬ +1
     â†“
   v1.2.0 (æ–°åŠŸèƒ½)   â† æ¬¡ç‰ˆæœ¬ +1, ä¿®è¨‚ç‰ˆæœ¬æ­¸é›¶
     â†“
   v2.0.0 (ç ´å£æ€§è®Šæ›´) â† ä¸»ç‰ˆæœ¬ +1, æ¬¡ç‰ˆæœ¬èˆ‡ä¿®è¨‚ç‰ˆæœ¬æ­¸é›¶
   ```

   **ä½•æ™‚éå¢**:

   - **ä¸»ç‰ˆæœ¬ (X.0.0)**: é‡å¤§æ¶æ§‹è®Šæ›´ã€ä¸å…¼å®¹çš„ API ä¿®æ”¹
   - **æ¬¡ç‰ˆæœ¬ (1.X.0)**: æ–°å¢åŠŸèƒ½ã€å‘å¾Œå…¼å®¹
   - **ä¿®è¨‚ç‰ˆæœ¬ (1.1.X)**: Bug ä¿®å¾©ã€å°æ”¹é€²

2. **è®Šæ›´åˆ†é¡**

   - âœ¨ æ–°åŠŸèƒ½ (New Features)
   - ğŸ› Bug ä¿®å¾© (Bug Fixes)
   - âš¡ æ€§èƒ½å„ªåŒ– (Performance)
   - ğŸ¨ UI/UX æ”¹é€² (UI/UX)
   - ğŸ“ æ–‡æª”æ›´æ–° (Documentation)
   - ğŸ”§ é…ç½®è®Šæ›´ (Configuration)

3. **è©³ç´°è³‡è¨Š** (é—œéµï¼)
   - **æª”æ¡ˆè·¯å¾‘**: å®Œæ•´çš„ç›¸å°è·¯å¾‘ (å¦‚ `src/App.vue`)
   - **è¡Œè™Ÿç¯„åœ**: ä¿®æ”¹çš„ç¨‹å¼ç¢¼ä½ç½® (å¦‚ L197-220)
   - **ä¿®æ”¹å…§å®¹**: å…·é«”åšäº†ä»€éº¼æ”¹å‹•
   - **ä¿®æ”¹åŸå› **: ç‚ºä»€éº¼è¦é€™æ¨£æ”¹
   - **å½±éŸ¿ç¯„åœ**: å½±éŸ¿äº†å“ªäº›åŠŸèƒ½

#### ç¯„ä¾‹æ ¼å¼

```markdown
### âœ¨ æ–°åŠŸèƒ½ï¼šå·² KEY è¨‚å–®è‡ªå‹•åŒ¹é…é©—è­‰

#### æ ¸å¿ƒé‚è¼¯ (Frontend)

**æª”æ¡ˆ**: `src/App.vue`

1. **ç‹€æ…‹è¨ˆç®—èˆ‡æ’åº** (L197-220)

   - æ–°å¢ `hasMismatch` ç‹€æ…‹æª¢æŸ¥
   - æ›´æ–° `groupStatus` å„ªå…ˆé †åºï¼š`mismatch > pending > checked_in > cancelled`
   - å¯¦ä½œæ’åºé‚è¼¯ï¼šKEY éŒ¯è¨‚å–®ç½®é ‚ï¼Œå·² KEY è¨‚å–®éæ¿¾éš±è—

2. **API æ•´åˆ** (L261-282)
   - ä¿®æ”¹ `markAsKeyed()` å‡½æ•¸ï¼Œè™•ç† Backend è¿”å›çš„ `mismatch` ç‹€æ…‹
   - å»¶é•· API timeout è‡³ 10 ç§’ï¼ˆå› éœ€æŸ¥è©¢ PMSï¼‰
   - æ–°å¢éŒ¯èª¤è™•ç†ï¼šåŒ¹é…å¤±æ•—æ™‚åˆ·æ–°åˆ—è¡¨é¡¯ç¤º KEY éŒ¯ç‹€æ…‹

### ğŸ› Bug ä¿®å¾©

1. **å¤šæˆ¿å‹åºŠå‹éŒ¯èª¤**
   - **æª”æ¡ˆ**: `bot.py` (L1171)
   - **å•é¡Œ**: æ‰€æœ‰æˆ¿å‹å…±ç”¨åŒä¸€å€‹ `bed_type`
   - **ä¿®å¾©**: è§£æåºŠå‹å­—ä¸²ï¼Œç‚ºæ¯å€‹æˆ¿å‹åˆ†é…æ­£ç¢ºåºŠå‹
   - **å½±éŸ¿**: ä¿®å¾©å¤šæˆ¿å‹é è¨‚æ™‚åºŠå‹è³‡è¨ŠéŒ¯èª¤çš„å•é¡Œ

### ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

- `src/App.vue` (L197-220, L261-282) - ç‹€æ…‹é‚è¼¯ã€API æ•´åˆ
- `src/style.css` (L1670-1706) - æ–°å¢ mismatch ç›¸é—œæ¨£å¼
```

#### ç¦æ­¢äº‹é …

- âŒ åªå¯«ã€Œä¿®å¾© Bugã€è€Œä¸èªªæ˜å…·é«”å•é¡Œ
- âŒ åªå¯«ã€Œå„ªåŒ–æ€§èƒ½ã€è€Œä¸èªªæ˜å„ªåŒ–äº†ä»€éº¼
- âŒ ä¸å¯«æª”æ¡ˆè·¯å¾‘å’Œè¡Œè™Ÿ
- âŒ ä¸èªªæ˜ä¿®æ”¹åŸå› 

### 2.4 README ç·¨å¯«è¦ç¯„

#### å¿…è¦ç« ç¯€

æ¯å€‹æ¨¡çµ„çš„ `README.md` å¿…é ˆåŒ…å«ï¼š

1. **æ¨¡çµ„æ¦‚è¿°**

   - ä¸€å¥è©±èªªæ˜æ¨¡çµ„ç”¨é€”
   - æ ¸å¿ƒåŠŸèƒ½åˆ—è¡¨ (ç”¨ âœ… æ¨™è¨˜å·²å®ŒæˆåŠŸèƒ½)

2. **æŠ€è¡“æ¶æ§‹**

   - æŠ€è¡“æ£§ (èªè¨€ã€æ¡†æ¶ã€ä¸»è¦ä¾è³´)
   - ç³»çµ±æ¶æ§‹åœ– (ç”¨ ASCII æˆ– Mermaid)

3. **æª”æ¡ˆçµæ§‹**

   - ç›®éŒ„æ¨¹ç‹€åœ–
   - é—œéµæª”æ¡ˆèªªæ˜

4. **å¿«é€Ÿé–‹å§‹**

   - ç’°å¢ƒéœ€æ±‚
   - å®‰è£æ­¥é©Ÿ
   - å•Ÿå‹•æŒ‡ä»¤

5. **æ ¸å¿ƒåŠŸèƒ½èªªæ˜**

   - æ¯å€‹ä¸»è¦åŠŸèƒ½çš„è©³ç´°èªªæ˜
   - ä½¿ç”¨ç¯„ä¾‹

6. **é–‹ç™¼æŒ‡å—**

   - å¦‚ä½•ä¿®æ”¹é…ç½®
   - å¦‚ä½•æ–°å¢åŠŸèƒ½
   - ç›¸é—œæ–‡æª”é€£çµ

7. **æ•…éšœæ’é™¤**

   - å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

8. **ç‰ˆæœ¬è³‡è¨Š**
   - ç•¶å‰ç‰ˆæœ¬è™Ÿ
   - æœ€å¾Œæ›´æ–°æ—¥æœŸ
   - CHANGELOG é€£çµ

#### ç¯„ä¾‹æ ¼å¼

```markdown
# æ¨¡çµ„åç¨±

> ä¸€å¥è©±èªªæ˜æ¨¡çµ„ç”¨é€”

---

## ğŸ“‹ æ¨¡çµ„æ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½

- âœ… åŠŸèƒ½ 1
- âœ… åŠŸèƒ½ 2
- â¸ï¸ åŠŸèƒ½ 3 (é–‹ç™¼ä¸­)

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### æŠ€è¡“æ£§

- **èªè¨€**: Python 3.9+
- **æ¡†æ¶**: Flask

### ç³»çµ±æ¶æ§‹

\`\`\`
ç”¨æˆ¶ â†’ API â†’ è³‡æ–™åº«
\`\`\`

---

## ğŸ“ æª”æ¡ˆçµæ§‹

\`\`\`
module/
â”œâ”€â”€ README.md
â”œâ”€â”€ CHANGELOG.md
â””â”€â”€ src/
\`\`\`

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒéœ€æ±‚

- Python 3.9+

### å®‰è£

\`\`\`bash
pip install -r requirements.txt
\`\`\`

---

## ğŸ“ ç‰ˆæœ¬è³‡è¨Š

- **ç•¶å‰ç‰ˆæœ¬**: v1.2.0
- **æœ€å¾Œæ›´æ–°**: 2025-12-17
- **ç¶­è­·è€…**: KTW Hotel IT Team

è©³ç´°è®Šæ›´è¨˜éŒ„è«‹åƒé–± [CHANGELOG.md](./CHANGELOG.md)
```

#### æ›´æ–°æ™‚æ©Ÿ

- æ–°å¢åŠŸèƒ½æ™‚ â†’ æ›´æ–°ã€Œæ ¸å¿ƒåŠŸèƒ½ã€ç« ç¯€
- ä¿®æ”¹æ¶æ§‹æ™‚ â†’ æ›´æ–°ã€ŒæŠ€è¡“æ¶æ§‹ã€ç« ç¯€
- æ–°å¢ç’°å¢ƒè®Šæ•¸æ™‚ â†’ æ›´æ–°ã€Œå¿«é€Ÿé–‹å§‹ã€ç« ç¯€
- ä¿®æ”¹ç‰ˆæœ¬æ™‚ â†’ æ›´æ–°ã€Œç‰ˆæœ¬è³‡è¨Šã€ç« ç¯€

---

## 3. ç¨‹å¼ä¿®æ”¹å‰ç½®æ¨™æº–æµç¨‹ (Pre-Coding SOP)

> âš ï¸ **åŸ·è¡ŒåŸå‰‡**ï¼šåœ¨ä¿®æ”¹ä»»ä½•ç¨‹å¼ç¢¼ä¹‹å‰ï¼Œå¿…é ˆåš´æ ¼åŸ·è¡Œä»¥ä¸‹ä¸‰æ­¥é©Ÿã€‚ç¦æ­¢ç›´æ¥å¯« Codeã€‚

### æ­¥é©Ÿ 1ï¼šæ­·å²å›é¡§èˆ‡æ–‡ä»¶æŸ¥é–± (Context Retrieval)

- **å¼·åˆ¶æŸ¥é–±**ï¼šå¿…é ˆå…ˆé–±è®€ç›¸é—œçš„ `README.md`ã€`GUIDE.md` æˆ–æ¶æ§‹æ–‡æª”ã€‚
- **ç¢ºèªç¾æ³**ï¼šç†è§£ç¾æœ‰ç¨‹å¼ç¢¼çš„è¨­è¨ˆæ„åœ–ï¼Œé¿å…ç ´å£æ—¢æœ‰é‚è¼¯ (Regression)ã€‚

### æ­¥é©Ÿ 2ï¼šå‰ç»å¾Œé¡§èˆ‡æœ€ä½³æ¨¡å¼åˆ†æ (Impact Analysis)

- **æœ€ä½³æ¨¡å¼**ï¼šæ€è€ƒã€Œé€™æ˜¯æ¥­ç•Œçš„æœ€ä½³å¯¦è¸ (Best Practice) å—ï¼Ÿã€
- **å‰ç»**ï¼šé€™å€‹ä¿®æ”¹å°æœªä¾†æ“´å……æœ‰å¹«åŠ©å—ï¼Ÿæœƒä¸æœƒé€ æˆæŠ€è¡“å‚µï¼Ÿ
- **å¾Œé¡§**ï¼šé€™å€‹ä¿®æ”¹æœƒä¸æœƒå½±éŸ¿èˆŠåŠŸèƒ½ï¼Ÿæ˜¯å¦èˆ‡ç¾æœ‰æ¶æ§‹è¡çªï¼Ÿ

### æ­¥é©Ÿ 3ï¼šæ–¹æ¡ˆç ”æ“¬èˆ‡åˆ©å¼Šåˆ†æ (Scenario Planning)

åœ¨å‹•æ‰‹å‰ï¼Œå¿…é ˆå‘ä½¿ç”¨è€…æå‡º **3 ç¨®è§£æ±ºæ–¹æ¡ˆ**ï¼Œä¸¦é€²è¡Œåˆ©å¼Šåˆ†æï¼š

| æ–¹æ¡ˆ  | èªªæ˜       | å„ªé» (Pros) | ç¼ºé» (Cons) | å»ºè­°ç¨‹åº¦ |
| :---: | :--------- | :---------- | :---------- | :------: |
| **A** | (æ–¹æ¡ˆåç¨±) | ...         | ...         |  â­â­â­  |
| **B** | (æ–¹æ¡ˆåç¨±) | ...         | ...         |   â­â­   |
| **C** | (æ–¹æ¡ˆåç¨±) | ...         | ...         |    â­    |

- **è¨è«–èˆ‡æ±ºç­–**ï¼šèˆ‡ä½¿ç”¨è€…è¨è«–ä¸¦é”æˆå…±è­˜å¾Œï¼Œæ‰å¯é€²å…¥å¯¦ä½œéšæ®µ (Coding)ã€‚

---

## 4. API è¨­è¨ˆæ€ç¶­ (API Design Philosophy)

åœ¨é¢å°è¤‡é›œçš„èˆŠç³»çµ±æ™‚ï¼ŒAPI ä¸æ‡‰åªæ˜¯è³‡æ–™åº«çš„ CRUD ä»‹é¢ï¼Œè€Œæ˜¯**æ¥­å‹™èƒ½åŠ›çš„å°è£**ã€‚

### 4.1 æ ¸å¿ƒåŸå‰‡

1.  **æ„åœ–å°å‘ (Intent-Based)**

    - âŒ **Don't**: `GET /api/guest_mn?id_cod=...` (æš´éœ²åº•å±¤è³‡æ–™è¡¨)
    - âœ… **Do**: `GET /api/guests/search?identity=...` (å°è£æ¥­å‹™å‹•ä½œ)
    - **ç†ç”±**ï¼šè§£è€¦å‰å¾Œç«¯ã€‚åº•å±¤è³‡æ–™ä¾†æºå¯èƒ½å¾ Oracle æ›æˆ PostgreSQLï¼Œä½† API ä»‹é¢æ‡‰ä¿æŒç©©å®šã€‚

2.  **é˜²è…å±¤ (Anti-Corruption Layer, ACL)**

    - **åŸå‰‡**ï¼šçµ•ä¸è®“èˆŠç³»çµ±çš„é«’å‘½å (Legacy Naming) æ±™æŸ“æ–°ç³»çµ±ã€‚
    - **å¯¦ä½œ**ï¼šåœ¨ API å±¤ (Node.js) é€²è¡Œè½‰æ›ã€‚
      - `IKEY` âœ `bookingId`
      - `GUEST_MN` âœ `GuestProfile`
      - `CI_DAT` âœ `checkInDate`

3.  **è®€å–å„ªåŒ– (Read-Optimized)**
    - **ç¾æ³**ï¼šèˆŠç³»çµ±éåº¦æ­£è¦åŒ–ï¼Œå°è‡´æŸ¥è©¢ç·©æ…¢ã€‚
    - **ç­–ç•¥**ï¼šé‡å°é«˜é »æŸ¥è©¢ï¼ˆå¦‚ã€Œä»Šæ—¥å…¥ä½åå–®ã€ï¼‰ï¼Œåœ¨ API å±¤åšèšåˆ (Aggregation)ï¼Œä¸€æ¬¡å›å‚³å®Œæ•´ JSONï¼Œæ¸›å°‘å‰ç«¯å¾€è¿”æ¬¡æ•¸ã€‚

---

## 5. èˆŠè³‡æ–™åº«æ¢ç´¢æŠ€å·§ (Legacy DB Exploration)

Oracle PMS æ˜¯ä¸€å€‹é»‘ç›’å­ï¼Œæ¢ç´¢éœ€è¬›æ±‚æ–¹æ³•ã€‚

### 5.1 æ¢ç´¢ SOP

1.  **Trace > Guess (è¿½è¹¤å‹æ–¼çŒœæ¸¬)**

    - å„ªå…ˆæŸ¥çœ‹ Application Log æˆ–é–‹å•Ÿ SQL Traceï¼Œè§€å¯Ÿç³»çµ±åœ¨åŸ·è¡Œç‰¹å®šå‹•ä½œï¼ˆå¦‚ check-inï¼‰æ™‚è§¸ç™¼äº†å“ªäº› SQLã€‚é€™æ¯”çœ‹æ¬„ä½åç¨±çŒœæ¸¬æº–ç¢ºå¾—å¤šã€‚

2.  **Data-Driven Inference (æ•¸æ“šæ¨æ–·)**

    - ä¸ç¢ºå®šæ¬„ä½ç”¨é€”æ™‚ï¼Œä½¿ç”¨ `SELECT DISTINCT` æŸ¥çœ‹å¯¦éš›å­˜å„²çš„å€¼ã€‚
      ```sql
      -- ç”¨æ•¸æ“šèªªè©±ï¼šçœ‹ GUEST_STA åˆ°åº•æœ‰å“ªäº›ç‹€æ…‹
      SELECT DISTINCT GUEST_STA, COUNT(*) FROM GUEST_MN GROUP BY GUEST_STA;
      ```

3.  **å»ºç«‹æ˜ å°„æ–‡æª” (Mapping Document)**

    - æŒçºŒç¶­è­· `pms-api/PMS-DATABASE-REFERENCE.md`ï¼Œé€™æ˜¯åœ˜éšŠæœ€é‡è¦çš„è³‡ç”¢ã€‚

4.  **å”ä½œåˆ†æèˆ‡è¨è«– (Collaborative Analysis)** â­
    - **åŸå‰‡**ï¼šæŸ¥åˆ°ä»»ä½•ä¸æ˜ç¢ºçš„æ¬„ä½æˆ–æ•¸æ“šæ™‚ï¼Œ**å‹™å¿…æäº¤çµ¦ä½¿ç”¨è€…åˆ†æ**ã€‚
    - **ç†ç”±**ï¼šä½¿ç”¨è€…ç†Ÿæ‚‰èˆŠç³»çµ±çš„å‰ç«¯é‚è¼¯ï¼ˆFrontend Logicï¼‰ï¼Œèƒ½å¾æ¬„ä½å€¼ä¸­ç™¼ç¾å·¥ç¨‹å¸«çœ‹ä¸å‡ºçš„æ¥­å‹™ç·šç´¢ï¼ˆä¾‹å¦‚ï¼šæŸå€‹ Flag ä»£è¡¨çš„ç‰¹å®šæ¥­å‹™æµç¨‹ï¼‰ã€‚
    - **è¡Œå‹•**ï¼šåœ¨ Task List æˆ–è¨è«–ä¸­åˆ—å‡º `[æ¬„ä½å]: [ç¯„ä¾‹å€¼]`ï¼Œé‚€è«‹ä½¿ç”¨è€…å…±åŒåˆ¤è®€ã€‚

### 5.2 PMS æ¬„ä½è¡¨æ ¼ç¶­è­·è¦ç¯„ â­

> [!IMPORTANT] > **æ ¸å¿ƒåŸå‰‡**ï¼š`pms-api/PMS-DATABASE-REFERENCE.md` æ˜¯è³‡æ–™åº«çµæ§‹çš„ **å–®ä¸€çœŸå¯¦ä¾†æº (SSOT)**ã€‚
>
> æ­¤æ–‡ä»¶çš„æº–ç¢ºæ€§ç›´æ¥å½±éŸ¿æœªä¾†è‡ªå»ºè³‡æ–™åº«çš„æ­£ç¢ºæ€§ï¼Œå¿…é ˆåš´æ ¼ç¶­è­·ã€‚

**ç¶­è­·æµç¨‹**ï¼š

1.  **ç™¼ç¾æ–°æ¬„ä½æˆ–ä»£ç¢¼**

    - é€é SQL æŸ¥è©¢ (`SELECT DISTINCT`) æ¢ç´¢æ¬„ä½çš„å¯èƒ½å€¼
    - è¨˜éŒ„åŸå§‹æ¬„ä½åã€å¯¦éš›æ•¸æ“šã€æ¨æ¸¬ç”¨é€”

2.  **äº¤å‰æ¯”å°é©—è­‰**

    - èˆ‡ PMS ç³»çµ±çš„å¯¦éš›è¡Œç‚ºé€²è¡Œæ¯”å°
    - ç¢ºä¿æ¬„ä½æè¿°èˆ‡è§€å¯Ÿåˆ°çš„æ•¸æ“šä¸€è‡´

3.  **æäº¤ä½¿ç”¨è€…ç¢ºèª** â­

    - **å¼·åˆ¶è¦å®š**ï¼šä»»ä½•æ–°ç™¼ç¾çš„æ¬„ä½æˆ–ä»£ç¢¼èªªæ˜ï¼Œå¿…é ˆå…ˆèˆ‡ä½¿ç”¨è€…ç¢ºèªå¾Œæ‰èƒ½å¯«å…¥æ–‡æª”
    - **ç†ç”±**ï¼šä½¿ç”¨è€…äº†è§£æ¥­å‹™é‚è¼¯ï¼Œèƒ½è­˜åˆ¥ AI æˆ–å·¥ç¨‹å¸«å¯èƒ½èª¤è§£çš„å°ˆæ¥­è¡“èª
    - **æ ¼å¼**ï¼šæä¾›è¡¨æ ¼å½¢å¼çš„å°ç…§èªªæ˜ï¼Œæ–¹ä¾¿ä½¿ç”¨è€…å¿«é€Ÿå¯©é–±

4.  **æ›´æ–°æ–‡æª”ä¸¦è¨˜éŒ„**
    - ç¢ºèªå¾Œæ›´æ–° `PMS-DATABASE-REFERENCE.md`
    - åœ¨ CHANGELOG ä¸­è¨˜éŒ„æ¬„ä½å®šç¾©çš„è®Šæ›´

**ç¯„ä¾‹ï¼šç‘•ç–µæˆ¿ vs ç¶­ä¿®æˆ¿**

| é¡å‹   | åˆ¤æ–·æ¢ä»¶                        | èªªæ˜           | å¯å”®ï¼Ÿ |
| :----- | :------------------------------ | :------------- | :----: |
| ç‘•ç–µæˆ¿ | `OOS_STA = Y` ä¸” `ROOM_STA = V` | æœ‰å°å•é¡Œä½†å¯è³£ |   âœ…   |
| ç¶­ä¿®æˆ¿ | `ROOM_STA = R`                  | æ­£åœ¨ç¶­ä¿®       |   âŒ   |

> **æ­¤å®šç¾©ç¶“ 2025-12-21 ä½¿ç”¨è€…ç¢ºèª**

---

## 6. è³‡æ–™åº«é·ç§»ç­–ç•¥ (Migration Strategy)

### 6.1 æˆ°ç•¥ï¼šçµæ®ºæ¦•æ¨¡å¼ (Strangler Fig Pattern)

çµ•å°ç¦æ­¢æ¡ç”¨ Big Bang (ä¸€æ¬¡æ€§åˆ‡æ›) æ¨¡å¼ã€‚æ‡‰æ¡ç”¨**é›™è»Œä¸¦è¡Œ**ç­–ç•¥ï¼Œé€æ­¥æ›¿æ›ã€‚

### 6.2 åŸ·è¡Œéšæ®µ (Phases)

#### Phase 1: æ—è·¯æ¨¡å¼ (Sidecar) - **ç›®å‰éšæ®µ**

- **ç‹€æ…‹**ï¼šOracle (Master) âœ PostgreSQL (Read-Only Slave/Cache)
- **æ©Ÿåˆ¶**ï¼šå–®å‘åŒæ­¥ã€‚å¯«ä¸€å€‹æ’ç¨‹å™¨ (Scheduler) æ¯ 5 åˆ†é˜å¾ Oracle æ’ˆå–ç•°å‹•è³‡æ–™ï¼Œå¯«å…¥ PostgreSQLã€‚
- **ç”¨é€”**ï¼šLINE Botã€Admin Dashboard è®€å– PostgreSQLï¼Œé€Ÿåº¦å¿«ä¸”ä¸å½±éŸ¿èˆŠç³»çµ±æ•ˆèƒ½ã€‚å¯«å…¥æ“ä½œä»å›åˆ° Oracleã€‚

#### Phase 2: å¢é‡å¯«å…¥ (Incremental Write)

- **ç‹€æ…‹**ï¼šæ–°åŠŸèƒ½è³‡æ–™ç›´æ¥å¯«å…¥ PostgreSQLã€‚
- **æ¡ˆä¾‹**ï¼šLINE åŠ å¥½å‹ç´€éŒ„ã€Wifi æˆæ¬Šç´€éŒ„ã€AI å°è©±æ—¥èªŒã€‚é€™äº›æ˜¯èˆŠç³»çµ±æ²’æœ‰çš„åŠŸèƒ½ï¼Œç›´æ¥åœ¨æ–°æ¶æ§‹è½åœ°ã€‚

#### Phase 3: å½±å­å¯«å…¥ (Shadow Write)

- **ç‹€æ…‹**ï¼šå˜—è©¦æ¥ç®¡å¯«å…¥ã€‚
- **æ©Ÿåˆ¶**ï¼šç•¶ç”¨æˆ¶åœ¨ Bot è¨‚æˆ¿æ™‚ï¼ŒAPI åŒæ™‚å¯«å…¥ PostgreSQL å’Œ Oracleï¼ˆé€éåŸå» ä»‹é¢æˆ–æ¨¡æ“¬æ“ä½œï¼‰ã€‚æ¯”å°å…©é‚Šçµæœæ˜¯å¦ä¸€è‡´ï¼Œç¢ºä¿é‚è¼¯æ­£ç¢ºã€‚

#### Phase 4: åˆ‡æ› (Cutover)

- **ç‹€æ…‹**ï¼šPostgreSQL å‡ç´šç‚ºä¸»åº« (Master)ã€‚
- **æ¢ä»¶**ï¼šOracle é™ç´šç‚ºåƒ…ä¾›æŸ¥è©¢çš„æ­·å²å­˜æª”åº« (Archive)ã€‚

---

## 8. Oracle æ¬„ä½æ ¸å°è¦å‰‡ (Field Verification) â­

> **é©ç”¨ç¯„åœ**ï¼š`ktw-oracle-to-pg` å°ˆæ¡ˆä¸­çš„æ¬„ä½æ¢ç´¢èˆ‡ L3 å»ºç«‹æµç¨‹ã€‚

### 8.1 æˆ‘å¿…é ˆæä¾›çš„æ ¼å¼

| æ¬„ä½    | å€¼         | å‚™è¨»                     |
| :------ | :--------- | :----------------------- |
| XXX_STA | Y          | ç‹€æ…‹ï¼Ÿ (Y=å•Ÿç”¨? N=åœç”¨?) |
| XXX_DAT | 2025-12-31 | æ—¥æœŸï¼Ÿ                   |

> **æ³¨æ„**ï¼šæ¨æ¸¬å‰å¿…é ˆéµå®ˆ 1.1 ç¯€ã€Œç ”ç©¶å°å‘ã€åŸå‰‡ã€‚

### 8.2 å‚™è¨»è¦å‰‡

- **æœ‰å°ç…§è¡¨çš„æ¬„ä½**ï¼šå¿…é ˆåˆ—å‡ºæ‰€æœ‰å¯èƒ½å€¼ + æ¨æ¸¬
  - ä¾‹ï¼š`ç‹€æ…‹ï¼Ÿ (Y=å•Ÿç”¨? N=åœç”¨? R=ç¶­ä¿®?)`
- **å•è™Ÿ?**ï¼šä»£è¡¨æœªç¢ºèª
- **ç„¡å•è™Ÿ**ï¼šä»£è¡¨å·²ç¢ºèª

### 8.3 æ ¸å°æµç¨‹

| æ­¥é©Ÿ | å‹•ä½œ                                       |
| :--: | :----------------------------------------- |
|  1   | æˆ‘æä¾›ï¼šæ¬„ä½ + å€¼ + å‚™è¨»ï¼Ÿ                 |
|  2   | ç”¨æˆ¶å›è²¼ç¢ºèªç‰ˆï¼ˆå»æ‰ ? æˆ–ä¿®æ”¹å…§å®¹ï¼‰        |
|  3   | æ²’ ? çš„å°±æ˜¯ç¢ºå®š                            |
|  4   | æˆ‘å¯«å…¥ `oracle_metadata.column_comments`   |
|  5   | å»ºç«‹/æ›´æ–° L3 View + COMMENT ON COLUMN      |
|  6   | é—œè¯ L1ã€L2 ä½œæ¥­ï¼ˆåŒæ­¥ã€table_catalog ç­‰ï¼‰ |

### 8.4 ç¢ºèªç¯„ä¾‹

**æˆ‘æä¾›ï¼š**

```
BED_STA | S | åºŠä½ç‹€æ…‹ï¼Ÿ (N=æ¨™æº–? M=ä½µåºŠ? S=åˆ†åºŠ?)
```

**ç”¨æˆ¶å›è²¼ï¼ˆç¢ºèªï¼Œå»æ‰?ï¼‰ï¼š**

```
BED_STA | S | åºŠä½ç‹€æ…‹ (N=æ¨™æº– M=ä½µåºŠ S=åˆ†åºŠ)
```

**æˆ–ç”¨æˆ¶å›è²¼ï¼ˆä¿®æ­£å…§å®¹ï¼‰ï¼š**

```
BED_STA | S | åºŠä½ç‹€æ…‹ (N=ä¸€èˆ¬åºŠ M=é›™äººåºŠ S=å–®äººåºŠ)
```

**æˆ‘åŸ·è¡Œï¼š**

1. å¯«å…¥ `oracle_metadata.column_comments`
2. æ›´æ–° L3 View COMMENT
3. åŠ å…¥åŒæ­¥æ¸…å–®ï¼ˆå¦‚éœ€è¦ï¼‰

---

## 9. çµè«– (Summary)

- **API å±¤**ï¼šåšç¿»è­¯å®˜ï¼Œä¸è¦åšå‚³è²ç­’ã€‚æŠŠ `IKEY` ç¿»è­¯æˆ `bookingId` å†çµ¦å‰ç«¯ã€‚
- **DB å±¤**ï¼šå…ˆæ±‚å…±å­˜ï¼Œå†æ±‚å–ä»£ã€‚å¾ã€Œè®€å–å„ªåŒ–ã€é–‹å§‹ï¼Œå»ºç«‹ä¿¡å¿ƒå¾Œå†è™•ç†ã€Œå¯«å…¥ã€ã€‚

---

_æ–‡ä»¶æœ€å¾Œæ›´æ–°ï¼š2025-12-28_
