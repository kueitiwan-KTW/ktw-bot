# 防控主機探索報告

> **日期**: 2025-12-23  
> **目標**: 建立 SSH 連線並分析房控系統 XML 格式

---

## 📋 探索摘要

成功連線到防控主機 (192.168.8.23)，找到房控系統的核心程式與 XML 資料格式，為未來自行解析房間狀態奠定基礎。

---

## 🖥️ 防控主機資訊

| 項目 | 值 |
|:-----|:---|
| **IP** | 192.168.8.23 |
| **電腦名稱** | DESKTOP-N7PQUIH |
| **作業系統** | Windows 10 (19045.6466) |
| **SSH 使用者** | USER |
| **認證方式** | 密碼 (公鑰待設定) |

---

## 🏗️ 房控系統架構

### 核心程式

| 程式 | 路徑 | 說明 |
|:-----|:-----|:-----|
| **RmsServer.exe** | `C:\Program Files (x86)\RmsServer\` | 房控伺服器，接收感應器訊號 |
| **PMSDB.exe** | 同上 | 連線 PMS 資料庫 (192.168.8.3) |
| **a6gw_file.exe** | `C:\Athena\a6gw_file\` | A6GW 匯入程式，讀取 XML 並寫入 DB |

### 資料流

```
房間感應器
    ↓
RmsServer.exe (接收訊號，產生 XML)
    ↓
C:\room\ (XML 檔案目錄)
    ↓
a6gw_file.exe (讀取 XML)
    ↓
PMSDB.exe → 192.168.8.3 Oracle DB
```

---

## 📂 XML 檔案結構

### 目錄

| 目錄 | 用途 |
|:-----|:-----|
| `C:\room\client\` | 待處理的 XML |
| `C:\room\processed\` | 已處理的 XML |
| `C:\room\log\` | 日誌檔案 |

### 檔案命名規則

- **請求檔**: `C04305XXX.xml`
- **回應檔**: `C04305XXX_ret.xml`

---

## 📝 XML 格式

### 請求檔案

```xml
<?xml version="1.0"?>
<ROWSET>
  <ROW>
    <REVE-CODE>0300811090</REVE-CODE>
    <ACTION_COD>ROOM_INF</ACTION_COD>
    <ROOM_NOS>616</ROOM_NOS>
    <ACTION_DAT>2025/12/23 00:31:32</ACTION_DAT>
  </ROW>
</ROWSET>
```

### 回應檔案 (_ret.xml)

```xml
<?xml version="1.0"?>
<ROWSET>
  <ROW>
    <SEND-CODE>0300811090</SEND-CODE>
    <ACTION_COD>ROOM_INF</ACTION_COD>
    <ROOM_NOS>616</ROOM_NOS>
    <ROOM_STA>V</ROOM_STA>
    <ADVBAL_AMT>0</ADVBAL_AMT>
    <CCARD_AMT>0</CCARD_AMT>
    <ACTION_DAT>2025/12/23 00:31:36</ACTION_DAT>
    <RETN-CODE>0000</RETN-CODE>
    <RETN-CODE-DESC>OK</RETN-CODE-DESC>
  </ROW>
</ROWSET>
```

### 關鍵欄位

| 欄位 | 說明 |
|:-----|:-----|
| `ROOM_NOS` | 房號 (如 301, 616) |
| `ROOM_STA` | 房間狀態 (V=空房, 其他待確認) |
| `ACTION_COD` | 動作類型 (ROOM_INF) |
| `ACTION_DAT` | 時間戳 |
| `RETN-CODE` | 0000=成功 |

---

## ⏭️ 後續待辦

- [ ] 設定 SSH 公鑰認證 (免密碼登入)
- [ ] 開發 Python 腳本監控 `C:\room\` 新 XML
- [ ] 解析 `ROOM_STA` 完整狀態碼對照表
- [ ] 整合房控訊號至 LINE Bot / Admin Dashboard
